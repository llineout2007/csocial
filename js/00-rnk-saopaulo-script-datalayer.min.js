function obterParametroPorNomeDatalayer(e,t){t=t||window.location.href,e=e.replace(/[\[\]]/g,"\\$&");e=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null}function getDataFromElement(e,t){return $(e).find(t).text().trim()||void 0}function getValueFromElement(e,t){return $(e).find(t).val()||void 0}function getDataFromAttribute(e,t){return $(e).attr(t)||null}function getPrice(e,t){e=$(e).find(t);return e.length?$.unmaskMoney(e.text()):null}function getDiscount(e,t){return e&&t?parseFloat(parseFloat(e-t).toFixed(2)):null}function getItemsIndex(e){try{let r=1;return e&&e.length&&e.forEach(t=>{Array.from($(t).parents(".prateleira").find("> ul > li")).some(e=>{return getValueFromElement(e,".product-sku")===getValueFromElement(t,".product-sku")||(r+=1,!1)})}),r}catch(e){console.log(e)}}function getItemsPartner(e){try{let t="loja-propria";return e&&e.length?e.forEach(e=>{"1"!=$(e).find('[class*="sellerId"]').val()&&(t="lojas-parceiras")}):"Drogaria SÃ£o Paulo"!=$(".rnk-comp-card-apresentacao-produto .seller-name a").text()&&(t="lojas-parceiras"),t}catch(e){console.log(e)}}function getItemsArray(e){try{const d=[];let a=getPrice(".rnk-comp-card-apresentacao-produto",".skuListPrice"),n=getPrice(".rnk-comp-card-apresentacao-produto",".skuBestPriceMinimumDiscount")||getPrice(".rnk-comp-card-apresentacao-produto",".skuBestPrice");var t=getDataFromElement(".rnk-comp-card-apresentacao-produto",".skuReference")||getValueFromElement(".rnk-comp-card-apresentacao-produto","#___rc-p-sku-ids")?.split(",")[0],r=getDataFromElement(".rnk-comp-card-apresentacao-produto",".productName"),s=vtxctx?.categoryName,l=getDataFromElement(".rnk-comp-marca",".brand"),m=getDataFromElement(".Campos-para-Renderizacao-de-Informacoes-Dinamicas",".value-field.Label-Sugestao-de-Produtos-na-PDP");let o="none"===$(".portal-notify-me-ref .notifyme").filter(":first").css("display"),i=getItemsIndex(e),c=getItemsPartner(e);if(e&&0<e.length){let r=getShelfTitle(e);e.forEach((e,t)=>{0<$(e).parents(".rnk-comp-compre-junto").length&&1<t||(a=getPrice(e,".valor-de"),n=getPrice(e,".valor-desconto-minimo")||getPrice(e,".valor-por"),o=0===$(e).find(".out-of-stock").length,t={item_id:getValueFromElement(e,".product-sku"),item_name:getDataFromElement(e,".descricao-prateleira .collection-link"),item_category:getValueFromElement(e,'[class*="nomeCategoria"]'),item_brand:getValueFromElement(e,'[class*="nomeMarca"]'),item_variant:getValueFromElement(e,'[class*="labelSugestao"]')&&getValueFromElement(e,'[class*="labelSugestao"]').includes("div")?$(getValueFromElement(e,'[class*="labelSugestao"]')).find("li").text()?$(getValueFromElement(e,'[class*="labelSugestao"]')).find("li").text():void 0:getValueFromElement(e,'[class*="labelSugestao"]'),discount:getDiscount(a,n),quantity:Number(getValueFromElement(e,".rnk-input-quantidade"))||1,price:n,index:i,in_stock:o,partner:c},r&&r.length&&(t.item_list_name=r),d.push(t))})}else d.push({item_id:t,item_name:r,item_category:s,item_brand:l,item_variant:m,price:n,in_stock:o,index:i,partner:c,discount:getDiscount(a,n),quantity:Number($(".rnk-comp-card-apresentacao-produto .rnk-input-quantidade").val())});return d}catch(e){console.log(e)}}function getShelfTitle(t=[]){try{if(!t||0===t.length)return"";var r=t[0];let e=$(r).parents(".prateleira").find("> h2").text()||$(r).parents(".container-chaordic-vitrine .container-prateleira").find("> h2").text()||"";return e=0===e.length&&($("body").hasClass("rnk-body-departamento")||$("body").hasClass("rnk-body-categoria")||$("body").hasClass("rnk-body-marca")||$("body").hasClass("rnk-body-busca-chaordic"))?$(".rnk-container-destaque h1").text():e}catch(e){console.log(e)}}function validateDataList(e=[],t=void 0){try{if(0===e.length)return!1;const r=["item_id","item_name"];return!1===e.every(e=>{for(const t of r)if(null===e[t])return!0;return!1})&&("string"!=typeof t||0<t.length)}catch(e){console.log(e)}}function preencherEmailClienteDatalayer(e){try{var t=window.visitorContactInfo||[],r=((e||{}).clientProfileData||{}).email;t.length?window.lastVisitorContactInfo!==t[0]&&(window.lastVisitorContactInfo=t[0],window.dataLayer.push({event:"visitorContactInfoChanged",lastVisitorContactInfo:t[0]})):r&&window.lastVisitorContactInfo!==r&&(window.lastVisitorContactInfo=r,window.dataLayer.push({event:"visitorContactInfoChanged",lastVisitorContactInfo:r}))}catch(e){}}function executarTriggerViewBannerHome(){try{$(".rnk-comp-departamentos, .rnk-comp-stories, .rnk-comp-carrousel, #open-modal-notificacoes .rnk-modal-content a, .rnk-comp-marcas-amadas, .rnk-comp-mosaicos, .rnk-comp-mosaico").each(function(e,i){try{if(!$(i).parents(".prateleira").length)if($.elementIsVisibleInViewport(i,!0)&&!$(i).hasClass("view_promotion_success")){let o=[];$(i).find("ul li a").each((e,t)=>{let r="";var t=(r=($(t).find("img").attr("data-src")?$(t).find("img").attr("data-src"):$(t).find("img").attr("data-splide-lazy")?$(t).find("img").attr("data-splide-lazy"):$(t).find("img").attr("src")).split("/arquivos/")[1])?.split("_")[0],a=r?.split("_")[1],n=r?.split("_")[2];($(i).parents(".rnk-comp-mosaicos").length||$(i).parents(".rnk-comp-mosaico").length?r?.split("_")[3]?.split("."):r?.split("_")[3]?.split("-"))?.[0];t&&a&&n&&o.push({promotion_id:t,promotion_name:a,creative_name:n})}),o.length&&(dataLayer.push({event:"view_promotion",event_type:"event_ecomm_recommended",ecommerce:{items:o}}),$(i).addClass("view_promotion_success"))}}catch(e){console.log(e)}})}catch(e){console.log("Erro ao executar executarTriggerViewBannerHome",e)}}function executarTriggerClickBannerHome(){$(".rnk-comp-departamentos ul li a, .rnk-comp-stories ul li a, .rnk-comp-carrosel ul li a, #open-modal-notificacoes .rnk-modal-content a, .rnk-comp-marcas-amadas ul li a").click(function(e){e.preventDefault(),dispararEventoBannersHome($(this))}),$(".rnk-comp-mosaicos ul li a, .rnk-comp-mosaico ul li a").click(function(e){e.preventDefault(),dispararEventoBannersHome($(this),!0)})}function dispararEventoBannersHome(e,t){var r=$(e).attr("href");try{var a=$(e).find("img").attr("src").split("/arquivos/")[1],n=a.split("_")[0],o=a.split("_")[1],i=a.split("_")[2],c=(t?a.split("_")[3].split("."):a.split("_")[3].split("-"))[0];dataLayer.push({event:"promotionClick",ecommerce:{promoClick:{promotions:[{id:n,name:o,creative:i,position:c}]}}})}catch(e){console.log("Ocorreu um erro ao disparar evento de banners",e)}document.location=r}function executarTriggerSelectItem(e){try{var t=getItemsArray([$(e).parents("li")]);validateDataList(t)&&dataLayer.push({event:"select_item",event_type:"event_ecomm_recommended",ecommerce:{currency:"BRL",items:t}})}catch(e){console.log("Erro ao disparar datalayer selectItem",e)}}function executarTriggerAddToWishlist(t){try{let e=getItemsArray([]);var r,a;$(t).parents(".prateleira").length&&(r=$(t).parents("li"),a=Array.from(r),e=getItemsArray(a)),dataLayer.push({event:"add_to_wishlist",event_type:"event_ecomm_recommended",ecommerce:{currency:"BRL",value:e?.[0]?.price??null,items:e}})}catch(e){console.log(e)}}function executarTriggerViewPromotion(e){try{let t=null,r=null,a=null,n=null,o=null,i=null,c=null,s=null,l=null;function m({creative_name:e,promotion_name:t,item_id:r,item_name:a,item_category:n,item_brand:o,price:i,discount:c}){dataLayer.push({ecommerce:null}),dataLayer.push({event:"view_promotion",ecommerce:{creative_name:e,promotion_name:t,items:[{item_id:r,item_name:a,discount:c,item_brand:o,item_category:n,price:i,quantity:1}]}})}e&&$(e).length?$(e).on("click",e=>{t=$(e.currentTarget).find(".flag-discount p").text(),r=t,a=$(e.currentTarget).find(".product-sku").val(),n=$(e.currentTarget).find(".descricao-prateleira .collection-link").html(),o=$(e.currentTarget).find('[class*="nomeCategoria"]').val(),i=$(e.currentTarget).find('[class*="nomeMarca"]').val(),c=$(e.currentTarget).find(".valor-desconto-minimo").length?$.unmaskMoney($(e.currentTarget).find(".valor-desconto-minimo").text()):$.unmaskMoney($(e.currentTarget).find(".valor-por").text()),s=$(e.currentTarget).find(".valor-de").text()?$.unmaskMoney($(e.currentTarget).find(".valor-de").text()):null,l=s&&c?parseFloat(parseFloat(s-c).toFixed(2)):null,t&&m({creative_name:t,promotion_name:r,item_id:a,item_name:n,item_category:o,item_brand:i,price:c,listPrice:s,discount:l})}):$("body").hasClass("rnk-body-produto")&&(t=$(".rnk-container-apresentacao-produto .rnk-flags .flag").text(),r=t,a=1<$("#___rc-p-sku-ids").val().split(",").length?$("#___rc-p-sku-ids").val().split(",")[0]:$("#___rc-p-sku-ids").val(),n=$(".rnk-comp-card-apresentacao-produto .productName").text(),o=vtxctx.categoryName||null,i=$(".rnk-comp-marca .brand").length?$(".rnk-comp-marca .brand").text():null,c=$(".rnk-comp-card-apresentacao-produto .skuBestPriceMinimumDiscount").length?$.unmaskMoney($(".rnk-comp-card-apresentacao-produto .skuBestPriceMinimumDiscount").text()):$.unmaskMoney($(".rnk-comp-card-apresentacao-produto .skuBestPrice").text()),s=$(".rnk-comp-card-apresentacao-produto .skuListPrice").length?$.unmaskMoney($(".rnk-comp-card-apresentacao-produto .skuListPrice").text()):null,l=s&&c?parseFloat(parseFloat(s-c).toFixed(2)):null,t)&&m({creative_name:t,promotion_name:r,item_id:a,item_name:n,item_category:o,item_brand:i,price:c,listPrice:s,discount:l})}catch(e){console.log(e)}}function dispararViewItem(e=[]){try{var t=getItemsArray(e);validateDataList(t)&&dataLayer.push({event:"view_item",event_type:"event_ecomm_recommended",ecommerce:{currency:"BRL",value:t[0].price,items:t}})}catch(e){console.log(e)}}function dispararViewItemList(e=[],t){try{var r,a=getItemsArray(e),n=getShelfTitle(e);validateDataList(a,n)&&(r=a.map(e=>{const{quantity:t,...r}=e;return r}),dataLayer.push({event:"view_item_list",event_type:"event_ecomm_recommended",item_list_name:n,ecommerce:{currency:"BRL",items:r}}),$(t).addClass("view_item_list_success"))}catch(e){console.log(e)}}function dispararViewPromotionPbm(e,t){try{var r=getItemsArray(0<$(e).parents(".rnk-comp-card-pbm-descontos-disponiveis").parents("li").length?[$(e).parents(".rnk-comp-card-pbm-descontos-disponiveis").parents("li")]:[]);dataLayer.push({event:"view_promotion",creative_name:t,promotion_name:t,ecommerce:{items:r}})}catch(e){console.log(e)}}function verificarViewItemList(){try{$(".prateleira:not(.view_item_list_success), .rnk-comp-compre-junto .container-prateleira:not(.view_item_list_success)").each((e,t)=>{try{var r;$.elementIsVisibleInViewport(t,!0)&&(r=$(t).find(".splide").length?$(t).find(".splide__slide:not(.splide__slide--clone)"):$(t).find("> ul > li"),dispararViewItemList(Array.from(r),t))}catch(e){console.log(e)}})}catch(e){console.log(e)}}function dispararAddToCart(){try{window.addEventListener("checkout:addToCart:done",e=>{var e=e?.detail?.target;e&&validateDataList(e=getItemsArray($(e).parents("li").length?[$(e).parents("li")]:[]))&&dataLayer.push({event:"add_to_cart",event_type:"event_ecomm_recommended",ecommerce:{currency:"BRL",value:e?.[0]?.price??null,items:e}})})}catch(e){console.log(e)}}function dispararRemoveToCart(){try{window.addEventListener("checkout:removeCart:done",e=>{var e=e?.detail?.target;e&&validateDataList(e=getItemsArray($(e).parents("li").length?[$(e).parents("li")]:[]))&&dataLayer.push({event:"remove_from_cart",currency:"BRL",value:e?.[0].price||null,items:e})})}catch(e){console.log(e)}}$(window).on("orderFormUpdated.vtex",function(e,t){preencherEmailClienteDatalayer(t)}),$(document).ready(()=>{dispararAddToCart(),dispararRemoveToCart(),executarTriggerViewPromotion(),executarTriggerViewBannerHome(),executarTriggerClickBannerHome(),$("body").hasClass("rnk-body-produto")&&dispararViewItem(),window.addEventListener("shelf:init",()=>{verificarViewItemList()}),$(window).scroll(()=>{verificarViewItemList(),executarTriggerViewBannerHome()})});