const FAV_ACCOUNT_NAME="drogariasp";let FAV_USER_ID="",FAV_LISTA_SKUS=[];$(document).ready((()=>{$.fav_iniciar()})),$.fav_iniciar=function(){try{$.fav_coletarUserId((()=>{$.fav_coletarFavoritos((()=>{$.fav_addBotaoFavorito(),$.fav_executarTriggerFavorito(),$(".prateleira > ul > li, .prateleira .splide__slide").each(((a,o)=>{$.fav_addBotaoFavorito(o);let e=$(o).find(".rnk-btn-favoritos");$.fav_executarTriggerFavorito(e)})),window.addEventListener("shelf:init:prateleiraItem",(function(a){if(a&&a.detail&&a.detail.prateleiraItem){$.fav_addBotaoFavorito(a.detail.prateleiraItem);let o=$(a.detail.prateleiraItem).find(".rnk-btn-favoritos");$.fav_executarTriggerFavorito(o)}})),$("body").hasClass("rnk-body-meus-favoritos")&&(FAV_USER_ID.length?$.fav_verificarSeTemProdutosFavoritos(FAV_LISTA_SKUS):($("#rnk-comp-modal-login").modal("show"),$.fav_verificarSeTemProdutosFavoritos([])))}))}))}catch(a){console.log(a)}},$.fav_coletarUserId=function(a){try{$.getProfile().then((o=>{o&&o.IsUserDefined?FAV_USER_ID=o.UserId:sessionStorage.removeItem("rnk_favoritos_lista_produtos"),a&&a()}))}catch(a){console.log(a)}},$.fav_coletarFavoritos=function(a){try{FAV_USER_ID.length?sessionStorage.getItem("rnk_favoritos_lista_produtos")?(FAV_LISTA_SKUS=JSON.parse(sessionStorage.getItem("rnk_favoritos_lista_produtos")).skus,a&&a()):$.ajax({type:"GET",url:"/api/dataentities/FV/search?_fields=sku,id&userId="+FAV_USER_ID+"&"+Math.floor(1e8*Math.random()),contentType:"application/json",headers:{"REST-Range":"resources=0-1000"}}).done((o=>{let e={},r=[],t=o.filter((a=>e[a.sku]?(r.push(a),!1):(e[a.sku]=!0,!0)));r.length&&$.fav_removerDuplicatasDosFavoritos(r);let s={userId:FAV_USER_ID,skus:t};FAV_LISTA_SKUS=t,sessionStorage.setItem("rnk_favoritos_lista_produtos",JSON.stringify(s)),a&&a()})):a&&a()}catch(a){console.log(a)}},$.fav_addBotaoFavorito=function(a){try{let o=!1,e=$("#___rc-p-sku-ids").val();if(e&&e.split(",").length>1&&(e=$("#___rc-p-sku-ids").val().split(",")[0]),a&&(e=$(a).find(".product-sku").val()),FAV_LISTA_SKUS&&FAV_LISTA_SKUS.length){o=FAV_LISTA_SKUS.filter((a=>a.sku===e)).length>0}let r='<button class="btn btn-outline-primary rnk-btn-favoritos" data-favorito="'+o+'">';r+='<span class="visually-hidden">'+(o?"Remover dos Favoritos":"Adicionar aos Favoritos")+"</span>",r+=o?'<i class="fa-solid fa-heart"></i>':'<i class="fa-light fa-heart"></i>',r+="</button>",$("body").hasClass("rnk-body-produto")&&!$(".portal-notify-me-ref .notifyme").is(":visible")&&($(".rnk-comp-card-apresentacao-produto h1, .apresentacao").find(".rnk-btn-favoritos").remove(),$(window).width()>768?$(".rnk-comp-card-apresentacao-produto h1").append(r):$(".apresentacao").append(r)),a&&($(a).find(".rnk-btn-favoritos").remove(),$(a).find(".rnk-container-comprar-produto").length?$(a).find(".rnk-container-comprar-produto").before(r):$(a).find(".buy-button-especial").before(r))}catch(a){console.log(a)}},$.fav_removerDosFavoritos=(a,o,e)=>{try{$.ajax({type:"GET",url:"https://frank-api.rankme.com.br/api/vtex/favorito/remover?rede=drogariasp&documentId="+a,contentType:"application/json"}).done((()=>{o&&o()})).fail((()=>{e&&e()}))}catch(a){console.log(a)}},$.fav_removerDuplicatasDosFavoritos=a=>{try{a.forEach((a=>{$.fav_removerDosFavoritos(a.id)}))}catch(a){console.log(a)}},$.fav_marcarProdutoFavorito=a=>{try{$(a).attr("data-favorito","true"),$(a).html('<span class="visually-hidden">Remover dos Favoritos</span><i class="fa-solid fa-heart"></i>')}catch(a){console.log(a)}},$.fav_desmarcarProdutoFavorito=a=>{try{$(a).attr("data-favorito","false"),$(a).html('<span class="visually-hidden">Adicionar aos Favoritos</span><i class="fa-light fa-heart"></i>')}catch(a){console.log(a)}},$.fav_atualizarListaProdutosFavoritos=(a,o,e)=>{try{let r=JSON.parse(sessionStorage.getItem("rnk_favoritos_lista_produtos"));a?r.skus.push({sku:o,id:e}):r.skus=r.skus.filter((a=>a.sku!=o)),sessionStorage.setItem("rnk_favoritos_lista_produtos",JSON.stringify(r))}catch(a){console.log(a)}},$.fav_adicionarAosFavoritos=(a,o)=>{try{$.fav_marcarProdutoFavorito(a),$.ajax({type:"PATCH",url:"/api/dataentities/FV/documents",data:JSON.stringify({userId:FAV_USER_ID,sku:o}),contentType:"application/json"}).done((e=>{$.fav_atualizarListaProdutosFavoritos(!0,o,e.DocumentId),executarTriggerAddToWishlist(a)})).fail((()=>{$.fav_desmarcarProdutoFavorito(a)}))}catch(a){console.log(a)}},$.fav_removerFavorito=(a,o)=>{try{$.fav_desmarcarProdutoFavorito(a);let e=FAV_LISTA_SKUS.filter((a=>a.sku===o))[0].id;$.fav_removerDosFavoritos(e,(()=>{$.fav_atualizarListaProdutosFavoritos(!1,o)}),(()=>{$.fav_marcarProdutoFavorito(a,o),$(a).parents("li").removeClass("d-none")})),$("body").hasClass("rnk-body-meus-favoritos")&&$(a).parents("li").addClass("d-none")}catch(a){console.log(a)}},$.fav_manipularClickFavoritos=(a,o,e)=>{try{FAV_USER_ID?"true"===$(a).attr("data-favorito")?($.fav_removerFavorito($(a),o),$.dispararEventoGA("Favoritos","Remover",e)):($.fav_adicionarAosFavoritos($(a),o),$.dispararEventoGA("Favoritos","Adicionar",e)):$("#rnk-comp-modal-login").modal("show")}catch(a){console.log(a)}},$.fav_executarTriggerFavorito=a=>{try{$("body").hasClass("rnk-body-produto")&&($(".rnk-comp-card-apresentacao-produto .rnk-btn-favoritos, .apresentacao .rnk-btn-favoritos").unbind("click"),$(".rnk-comp-card-apresentacao-produto .rnk-btn-favoritos, .apresentacao .rnk-btn-favoritos").click((a=>{a.preventDefault();let o=$("#___rc-p-sku-ids").val();o&&o.split(",").length>1&&(o=$("#___rc-p-sku-ids").val().split(",")[0]);let e=$(".rnk-comp-card-apresentacao-produto .productName").text();$.fav_manipularClickFavoritos($(a.currentTarget),o,e)}))),$(a).length&&($(a).unbind("click"),$(a).click((a=>{a.preventDefault();let o=$(a.currentTarget).parents("li").find(".product-sku").val(),e=$(a.currentTarget).parents("li").find(".descricao-prateleira .collection-link").text();$.fav_manipularClickFavoritos($(a.currentTarget),o,e)})))}catch(a){console.log(a)}},$.fav_montarPrateleiraDosFavoritos=async function(a){try{if(a){let o=[],e=0;for(let r of a)$.getJSON("/api/catalog_system/pub/products/search?fq=productId:"+r.sku,(function(a){o.push(a),e+=1}));let r=setInterval((function(){o.length==a.length&&($.fav_montarPrateleiraDosFavoritosAsync(o,a),clearInterval(r))}),250)}}catch(a){console.log(a)}},$.fav_montarPrateleiraDosFavoritosAsync=function(a,o){try{let o=a;try{o=o.filter((a=>a&&a.length>0)),o=o.sort(((a,o)=>{if(!(a&&a.length&&o&&o.length))return 0;let e=!!a[0].items[0].sellers[0].commertialOffer.IsAvailable&&a[0].items[0].sellers[0].commertialOffer.IsAvailable;return e===(!!o[0].items[0].sellers[0].commertialOffer.IsAvailable&&o[0].items[0].sellers[0].commertialOffer.IsAvailable)?0:e?-1:1}))}catch(a){console.log(a)}let e="";e+="        \t\t<ul>",$(o).each((function(a,o){if(o&&o.length){let a=window.location.origin+"/checkout/cart/add?sku="+o[0].productId+"&qty=1&seller="+o[0].items[0].sellers[0].sellerId+"&sc=1",r=!!o[0].items[0].sellers[0].commertialOffer.Teasers[0]&&o[0].items[0].sellers[0].commertialOffer.Teasers[0];r&&(r=[o[0].items[0].sellers[0].commertialOffer.Teasers[0]["<Name>k__BackingField"]]);const t=$.shelf_getItem({name:o[0].items[0].nameComplete,skuId:o[0].productId,price:o[0].items[0].sellers[0].commertialOffer.Price,listPrice:o[0].items[0].sellers[0].commertialOffer.ListPrice,url:o[0].link,imgUrl:o[0].items[0].images[0].imageUrl,urlAddToCart:a,isAvailable:o[0].items[0].sellers[0].commertialOffer.IsAvailable,quantidadeUnitario:o[0].Quantidade?o[0].Quantidade:[],sufixoUnidade:o[0]["Sufixo R$/unidade"]?o[0]["Sufixo R$/unidade"]:[],entregaEspecial:o[0]["Entrega Especiais"]?o[0]["Entrega Especiais"]:[],tipoMedicamento:o[0]["Tipo de Medicamento"]?o[0]["Tipo de Medicamento"]:[],classeMedicamento:o[0]["Classe do Medicamento"]?o[0]["Classe do Medicamento"]:[],prescricaoMedica:o[0]["Prescrição Médica"]?o[0]["Prescrição Médica"]:[],valorDescontoMinimo:o[0]["Valor Desconto Minimo"]?o[0]["Valor Desconto Minimo"]:[],valorDescontoMaximo:o[0]["Valor Desconto Maximo"]?o[0]["Valor Desconto Maximo"]:[],descontoPromocao:o[0]["Descontos e Promoções"]?o[0]["Descontos e Promoções"]:[],pbmAutorizadora:o[0].PBM?o[0].PBM:[],pbmPrograma:o[0]["PBM Programa"]?o[0]["PBM Programa"]:[],pds:o[0].PDS?o[0].PDS:[],flagsDiscount:r||!1,nomeCategoria:o[0].categories?o[0].categories:[],nomeMarca:o[0].brand?o[0].brand:[],preVenda:[]});e+=t}})),e+="\t\t</ul>",$(".rnk-container-prateleira-produtos-favoritos .prateleira").html(e),$.shelf_executarFuncoes()}catch(a){console.log(a)}},$.fav_verificarSeTemProdutosFavoritos=function(a){try{a&&a.length>0?$.fav_montarPrateleiraDosFavoritos(a):($(".rnk-container-prateleira-produtos-favoritos .row").html(""),$(".rnk-container-lista-vazia").removeAttr("hidden"))}catch(a){console.log(a)}};