import{nanoid}from"https://cdn.jsdelivr.net/npm/nanoid/nanoid.js";const HEADER_CH_API_KEY="drogariasp";let SUFIXO_TESTEAB_BUSCA="";$(document).ready(function(){$.headerCh_carregarMaisBuscados(),$.headerCh_mostrarComponente(),$.headerCh_ocultarComponente(),$.headerCh_listenerBtnBusca(),$.headerCh_listenerFormBusca(),$.headerCh_listenerInputBusca(),$.headerCh_limparBusca()}),$.headerCh_higienizarTermoDigitado=function(e){try{return e&&"string"==typeof e?e=(e=(e=e.replaceAll("script","")).replaceAll("%","")).replaceAll("&","e"):null}catch(e){console.log(e)}},$.headerCh_carregarMaisBuscados=function(){try{$.getProfile().then(o=>{$.getJSON("/api/io/_v/api/intelligent-search/top_searches",function({searches:e}){let a=$.headerCh_carregarBuscasRecentes();e&&e?.length&&(a=(a+='<div class="rnk-comp-header-chaordic-mais-buscados">')+'    <h3>Mais Buscados</h3>    <ol class="rnk-comp-header-chaordic-lista-mais-buscados">',$(e).each((e,{term:r})=>{/^\d{5}/.test(r.trim())||-1==r.toUpperCase().indexOf("OZEMPIC")&&(a=(a+='<li><a href="/pesquisa?q='+r)+"&source="+$.mobileCheck(),o.IsUserDefined&&(a+="&userId="+o.UserId),a+='">'+r+"</a></li>")}),a+="    </ol></div>"),$(".rnk-comp-header-chaordic-resultado-busca").html(a),$.headerCh_removerBannerAdsVtex(),$.headerCh_showBannerPromocional()})})}catch(e){console.log(e)}},$.headerCh_getPropertie=function(e,r){try{var a=e["properties"];if(a&&a.length&&r&&r.length){var o=a.filter(e=>e.name===r);if(o&&o.length)return o[0].values[0]}return null}catch(e){console.log(e)}},$.headerCh_carregarSugestoes=function(i){try{Number(i)?$(".rnk-container-header-chaordic-resultado").attr("hidden",!0):($(".rnk-container-header-chaordic-resultado").removeAttr("hidden"),$.getProfile().then(async e=>{var r="/api/io/_v/api/intelligent-search/product_search/trade-policy/1?query="+i+"&count=4&page=1",o=await $.getJSON("/api/io/_v/api/intelligent-search/autocomplete_suggestions?query="+i),r=await $.getJSON(r),c=await $.headerCh_getBannerAdsVtex(i),o=o?.searches||[];if($.headerCh_carregarBannerAdsVtex(c),o?.length){$(".rnk-comp-header-chaordic-sugestoes").remove();let a="";a=a+'<div class="rnk-comp-header-chaordic-sugestoes">'+'    <ul class="rnk-comp-header-chaordic-lista-mais-buscados">';c=o.sort((e,r)=>{var a=e.term.toLowerCase().startsWith(i.toLowerCase()),o=r.term.toLowerCase().startsWith(i.toLowerCase());return a&&!o?-1:!a&&o?1:e.term.length-r.term.length});$(c).each((e,{term:r})=>{4<e||(a=(a=(a+='<li><a href="/pesquisa?q='+r+'">')+'<svg class="me-2" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor"><path d="M384 208A176 176 0 1 0 32 208a176 176 0 1 0 352 0zM343.3 366C307 397.2 259.7 416 208 416C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208c0 51.7-18.8 99-50 135.3L507.3 484.7c6.2 6.2 6.2 16.4 0 22.6s-16.4 6.2-22.6 0L343.3 366z"/></svg><span class="me-auto">'+r+"</span>")+'<svg class="me-3" width="16" height="16" aria-hidden="true" focusable="false" data-prefix="fal" data-icon="arrow-up-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" data-fa-i2svg=""><path fill="currentColor" d="M336 96c8.8 0 16 7.2 16 16l0 224c0 8.8-7.2 16-16 16s-16-7.2-16-16l0-185.4L59.3 411.3c-6.2 6.2-16.4 6.2-22.6 0s-6.2-16.4 0-22.6L297.4 128 112 128c-8.8 0-16-7.2-16-16s7.2-16 16-16l224 0z"></path></svg></a></li>')}),a=a+"    </ul>"+"</div>",$("div.rnk-comp-header-chaordic-produtos").length?$("div.rnk-comp-header-chaordic-produtos").before(a):($(".rnk-comp-header-chaordic-loading").remove(),$(".rnk-comp-header-chaordic-resultado-busca").append(a))}else $(".rnk-comp-header-chaordic-produtos").length||$(".rnk-comp-header-chaordic-resultado-busca").html('<div class="alert alert-warning d-flex align-items-center gap-2 mb-1"><i class="fa-solid fa-triangle-exclamation"></i>Não encontramos sugestões para "'+i+'".</div>');if(r?.products?.length){o=r.products.filter(e=>"string"==typeof e.items[0]?.images[0]?.imageUrl);$(".rnk-comp-header-chaordic-produtos").remove();let s="";s=(s=(s=s+'<div class="rnk-comp-header-chaordic-produtos">'+'    <div class="d-flex flex-column">')+('        <a href="'+i+'" class="rnk-produto-all">Ver todos</a>')+'        <h3 class="mb-0">Produtos</h3>')+"    </div>"+'    <ul class="rnk-comp-header-chaordic-produtos">',$(o).each((e,r)=>{var a=r.items?.[0]?.images?.[0]?.imageUrl?.replace(/(ids\/\d+)(?=\/)/,"$1-100-100"),o=r.items?.[0]?.sellers?.find(e=>!0===e.sellerDefault),c=$.headerCh_getPropertie(r,"Valor Desconto Minimo"),t=$.headerCh_getPropertie(r,"Valor Desconto Maximo"),o=o?.commertialOffer?.Price??0;let n=0;t&&t<o?n=$.maskMoney(Number(t)):c&&c<o?n=$.maskMoney(Number(c)):o&&(n=$.maskMoney(o)),s=(s=(s=(s=(s=(s+="<li>")+'<a href="'+r.link+'" ')+'data-product-id="'+r.productId+'" ')+'data-query="'+i+'" data-index="'+(e+1)+'">')+'<img src="'+a+'" alt="'+r.productName+'" />')+'<p class="rnk-nome-produto">'+r.productName+"</p>",n&&(s+='<p class="rnk-preco-produto">'+n+"</p>"),s+="</a></li>"}),s=(s+="    </ul>")+('    <a href="'+i+'" class="rnk-produto-all">Ver todos os produtos</a>')+"</div>",$(".rnk-comp-header-chaordic-sugestoes").length?$(".rnk-comp-header-chaordic-sugestoes").after(s):($(".rnk-comp-header-chaordic-loading").remove(),$(".rnk-comp-header-chaordic-resultado-busca").append(s)),$.headerCh_listernerTracking()}else $(".rnk-comp-header-chaordic-sugestoes").length||$(".rnk-comp-header-chaordic-resultado-busca").html('<div class="alert alert-warning d-flex align-items-center gap-2 mb-1"><i class="fa-solid fa-triangle-exclamation"></i>Não encontramos sugestões para "'+i+'".</div>')}))}catch(e){console.log(e)}},$.headerCh_listernerTracking=function(){try{$(".rnk-comp-header-chaordic-produtos ul a").unbind("click"),$(".rnk-comp-header-chaordic-produtos ul a").on("click",e=>{e.preventDefault();var r=nanoid(),a=nanoid();$.ajax({url:"https://sp.vtex.com/event-api/v1/"+HEADER_CH_API_KEY+"/event",type:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify({type:"search.click",productId:$(e.currentTarget).attr("data-product-id"),position:Number($(e.currentTarget).attr("data-index")),url:$(e.currentTarget).attr("href"),text:$(e.currentTarget).attr("data-query"),agent:navigator.userAgent,anonymous:a,session:r})}).always(()=>{location.href=$(e.currentTarget).attr("href")})})}catch(e){console.log(e)}},$.headerCh_mostrarComponente=function(){try{const a=$(".rnk-container-header-offcanvas-menu"),o=$(".rnk-comp-header-form-busca-chaordic .rnk-input-chaordic");function r(e){try{$("body").css("overflow","hidden"),$(o).addClass("show"),$(o).parents(".rnk-comp-header-form-busca-chaordic").addClass("show"),setTimeout(()=>{$(o)[0].focus()},10),$(e.currentTarget).unbind("hidden.bs.offcanvas",r)}catch(e){console.log(e)}}$(".rnk-comp-header-form-busca-chaordic .rnk-input-chaordic").on("focus",e=>{$(a).hasClass("show")?($(a).on("hidden.bs.offcanvas",r),$(a).offcanvas("hide")):($("body").css("overflow","hidden"),$(e.currentTarget).addClass("show"),$(e.currentTarget).parents(".rnk-comp-header-form-busca-chaordic").addClass("show"))})}catch(e){console.log(e)}},$.headerCh_ocultarComponente=function(){try{$(document).on("click keydown",e=>{var r=e.keyCode||e.which;!$(e.target).hasClass("rnk-comp-header-chaordic-overlay")&&27!=r||($("body").removeAttr("style"),$(".rnk-comp-header-form-busca-chaordic").removeClass("show"),$(".rnk-comp-header-form-busca-chaordic .rnk-input-chaordic").val(""),$(".rnk-comp-header-form-busca-chaordic .rnk-input-chaordic").trigger("blur"),$(".rnk-comp-header-form-busca-chaordic .rnk-input-chaordic").removeClass("show"),$.headerCh_carregarMaisBuscados())}),$(".rnk-btn-header-fechar-chaordic").on("click",()=>{$("body").removeAttr("style"),$(".rnk-comp-header-form-busca-chaordic").removeClass("show"),$(".rnk-comp-header-form-busca-chaordic .rnk-input-chaordic").val(""),$(".rnk-comp-header-form-busca-chaordic .rnk-input-chaordic").trigger("blur"),$(".rnk-comp-header-form-busca-chaordic .rnk-input-chaordic").removeClass("show"),$.headerCh_carregarMaisBuscados()})}catch(e){console.log(e)}},$.headerCh_redirecionarParaBuscaChaordic=function(e){try{$.headerCh_adicionarBuscaRecente(e),location.href="/pesquisa?q="+e}catch(e){console.log(e)}},$.headerCh_listenerFormBusca=function(){try{$(".rnk-comp-header-form-busca-chaordic").on("submit",e=>{e.preventDefault();e=$(e.currentTarget).find(".rnk-input-chaordic"),e=$.headerCh_higienizarTermoDigitado($(e).val());e&&e.length&&$.headerCh_redirecionarParaBuscaChaordic(e)})}catch(e){console.log(e)}},$.headerCh_listenerInputBusca=function(){try{let e;$(".rnk-comp-header-form-busca-chaordic .rnk-input-chaordic").on("input",a=>{clearTimeout(e),$(".rnk-comp-header-chaordic-loading").length||($(".rnk-comp-header-chaordic-resultado-busca").html('<div class="text-center p-3 rnk-comp-header-chaordic-loading"><div class="spinner-border" role="status"><span class="visually-hidden">Buscando...</span></div></div>'),$.headerCh_hideBannerPromocional()),e=setTimeout(()=>{var e,r=$.headerCh_higienizarTermoDigitado($(a.currentTarget).val());r?.length?(e=a.keyCode||a.which)&&13==e?$.headerCh_redirecionarParaBuscaChaordic(r):$.headerCh_carregarSugestoes(r):$.headerCh_carregarMaisBuscados()},200)})}catch(e){console.log(e)}},$.headerCh_listenerBtnBusca=function(){try{$(".rnk-comp-header-form-busca-chaordic .rnk-btn-chaordic").on("click",e=>{e.preventDefault();e=$.headerCh_higienizarTermoDigitado($(e.currentTarget).siblings(".rnk-input-chaordic").val());e?.length&&$.headerCh_redirecionarParaBuscaChaordic(e)})}catch(e){console.log(e)}},$.testeAB=function(){try{null==sessionStorage.getItem("dpsp_busca_vtex_ab")&&(5<Math.floor(10*Math.random())?sessionStorage.setItem("dpsp_busca_vtex_ab","&lid=7ad84358-e06e-4266-b263-8275eefc500f"):sessionStorage.setItem("dpsp_busca_vtex_ab","")),SUFIXO_TESTEAB_BUSCA=sessionStorage.getItem("dpsp_busca_vtex_ab")}catch(e){console.log("Erro ao executar Teste AB da busca vtex",e)}},$.headerCh_adicionarBuscaRecente=function(e){try{var r=JSON.parse(localStorage.getItem("headerCh_buscasRecentes"))||[];if(-1<r.indexOf(e))return!1;5<r.length&&r.shift(),r.push(e),localStorage.setItem("headerCh_buscasRecentes",JSON.stringify(r))}catch(e){console.log(e)}},$.headerCh_carregarBuscasRecentes=function(){try{var e=JSON.parse(localStorage.getItem("headerCh_buscasRecentes"))||[];if(e.length){let a="";return a=(a+='<div class="rnk-comp-header-chaordic-buscas-recentes">')+"    <h3>Seu Histórico de Busca</h3>"+'    <ul class="rnk-comp-header-chaordic-lista-buscas-recentes">',$(e).each((e,r)=>{-1==r.toUpperCase().indexOf("OZEMPIC")&&(a=a+'<li><a href="/pesquisa?q='+r+'">'+r+"</a></li>")}),a=a+"    </ul>"+"</div>"}return""}catch(e){console.log(e)}},$.headerCh_limparBusca=function(){$(".rnk-comp-header-form-busca-chaordic .rnk-btn-clear-search").on("click",e=>{e.preventDefault(),$(".rnk-comp-header-form-busca-chaordic .rnk-input-chaordic").val(""),$.headerCh_carregarMaisBuscados()})},$.headerCh_hideBannerPromocional=function(){try{$(".rnk-comp-header-chaordic-banner-promocional").addClass("d-none")}catch(e){console.log(e)}},$.headerCh_showBannerPromocional=function(){try{$(".rnk-comp-header-chaordic-banner-promocional").removeClass("d-none")}catch(e){console.log(e)}},$.headerCh_removerBannerAdsVtex=function(){try{$(".rnk-comp-header-chaordic-banner-promocional .rnk-banner-ads-vtex-por-termo").remove()}catch(e){console.log(e)}},$.headerCh_getBannerAdsVtex=async function(e){try{var r={context:"search",term:e,placements:{site_header_busca_bottom_banner:{quantity:1,types:["banner"],size:$.vtexAds_getDataToDeskAndMobi("558x170","304x90")}}};return $.vtexAds_getNewtail(r)}catch(e){console.log(e)}},$.headerCh_carregarBannerAdsVtex=function(e){try{$.headerCh_removerBannerAdsVtex();var r=e.site_header_busca_bottom_banner;if(!r||0===r.length)return $.headerCh_showBannerPromocional(),!1;var a=r[0],o=(o='<a class="rnk-banner-ads-vtex-por-termo" href="'+a.destination_url+'" data-impression="'+a.impression_url+'" data-click="'+a.click_url+'" data-view="'+a.view_url+'">')+('\t<img class="img-fluid" src="'+a.media_url+'" alt="'+a.campaign_name+'" />')+"</a>";$(".rnk-comp-header-chaordic-banner-promocional").append(o),$.headerCh_showBannerPromocional(),$.vtexAds_dispararEventos(".rnk-comp-header-chaordic-banner-promocional .rnk-banner-ads-vtex-por-termo")}catch(e){console.log(e)}};