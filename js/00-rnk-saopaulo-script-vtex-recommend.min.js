const VTEX_RECS_CONFIG={storeName:"drogariasp",async getUserId(){return $.getCookieByName("_snrs_puuid")||$.getCookieByName("_snrs_uuid")},get headers(){return{"x-vtex-rec-origin":this.storeName+"/storefront/portal","Content-Type":"application/json"}},get api(){return{baseUrl:"/api/recommend-bff/v2",recommendations:"/recommendations",events:{recommendationView:"/events/recommendation-view",recommendationClick:"/events/recommendation-click"},get full(){return{recommendations:""+this.baseUrl+this.recommendations,recommendationView:""+this.baseUrl+this.events.recommendationView+"?an="+VTEX_RECS_CONFIG.storeName,recommendationClick:""+this.baseUrl+this.events.recommendationClick+"?an="+VTEX_RECS_CONFIG.storeName}}}}};$(document).ready(()=>{$.vtexRecs_renderRecommendations(),$.vtexRecs_setUserIdOrderForm()}),$.vtexRecs_setUserIdOrderForm=async function(){try{var t=(await vtexjs.checkout.getOrderForm()).orderFormId;if(!t)throw"orderFormId não encontrado";var e,r=await VTEX_RECS_CONFIG.getUserId();if(r)return e=$(window).width()<577?"WEB_MOBILE":"WEB_DESKTOP",{success:!0,data:await $.ajax({type:"PUT",url:`/api/checkout/pub/orderForm/${t}/customData/synerise`,headers:{contentType:"application/json; charset=utf-8",dataType:"json"},data:JSON.stringify({uuid:r,source:e})})};throw"userId não encontrado"}catch(t){return console.log(t),{success:!1,error:t}}},$.vtexRecs_sendRecommendationView=async function(t={}){try{if(!t.correlationId||!t.products)throw"Parâmetros correlationId e products são obrigatórios";var e=await VTEX_RECS_CONFIG.getUserId();if(e)return{success:!0,data:await $.ajax({type:"POST",url:VTEX_RECS_CONFIG.api.full.recommendationView,headers:VTEX_RECS_CONFIG.headers,data:JSON.stringify({userId:e,correlationId:t.correlationId,products:t.products})})};throw"userId não encontrado"}catch(t){return console.log(t),{success:!1,error:t}}},$.vtexRecs_sendRecommendationClick=async function(t={}){try{if(!t.correlationId||!t.product)throw"Parâmetros correlationId e product são obrigatórios";var e=await VTEX_RECS_CONFIG.getUserId();if(e)return{success:!0,data:await $.ajax({type:"POST",url:VTEX_RECS_CONFIG.api.full.recommendationClick,headers:VTEX_RECS_CONFIG.headers,data:JSON.stringify({userId:e,correlationId:t.correlationId,product:t.product})})};throw"userId não encontrado"}catch(t){return console.log(t),{success:!1,error:t}}},$.vtexRecs_bindRecommendationView=function(){try{let e=!1,r=[];const a=()=>{r.forEach(t=>{t.hasClass("event-view-success")||t.hasClass("event-view-pending")||"cluster"===t.data("source")||$.elementIsVisibleInViewport(t[0],!0)&&o(t)})},o=async t=>{var e=t.data("correlation-id"),r=t.data("products")?.split(",");e&&r.length&&(t.addClass("event-view-pending"),e=(await $.vtexRecs_sendRecommendationView({correlationId:e,products:r}))["success"],e&&t.addClass("event-view-success"),t.removeClass("event-view-pending"))};return function(t){t=$(t).toArray().map(t=>$(t));if(r.push(...t),!e){e=!0;let t;$(window).on("scroll",()=>{clearTimeout(t),t=setTimeout(a,200)}),a()}}}catch(t){console.log(t)}}(),$.vtexRecs_bindRecommendationClick=function(t){try{var e=$(t);e.length&&(e.off("click"),e.on("click",async function(t){t.preventDefault();var t=$(t.currentTarget),e=t.data("product"),r=t.data("correlation-id");if("cluster"===t.closest(".card").data("source"))return window.location.href=t.attr("href");t.hasClass("event-click-pending")||(t.hasClass("event-click-success")||(t.addClass("event-click-pending"),r=(await $.vtexRecs_sendRecommendationClick({correlationId:r,product:String(e)}))["success"],r&&t.addClass("event-click-success"),t.removeClass("event-click-pending")),window.location.href=t.attr("href"))}))}catch(t){console.log(t)}},$.vtexRecs_dispararRecommendationClick=function(o){return new Promise((t,e)=>{try{var r=o.closest(".rnk-container-vtex-recommendations-prateleira").data("correlation-id"),a=o.parents("li").find(".product-sku").val();if(!r||!a)return e(new Error("Parâmetros correlationId e productId são obrigatórios"));$.vtexRecs_sendRecommendationClick({correlationId:r,product:String(a)}).then(t).catch(e)}catch(t){e(t)}})},$.vtexRecs_getRecommendations=async function(t={}){try{var e={userId:await VTEX_RECS_CONFIG.getUserId(),an:VTEX_RECS_CONFIG.storeName,campaignVrn:t.campaignVrn};if(!e.userId)throw"userId não encontrado";if(e.campaignVrn)return t.products&&(e.products=t.products),{success:!0,data:await $.ajax({type:"GET",url:VTEX_RECS_CONFIG.api.full.recommendations,headers:VTEX_RECS_CONFIG.headers,data:e})};throw"campaignVrn é obrigatório"}catch(t){return console.log(t),{success:!1,error:t}}},$.vtexRecs_getClusterProducts=async function(t="6772"){try{return{success:!0,data:{products:await $.getJSON(`/api/catalog_system/pub/products/search?fq=productClusterIds:${t}&_from=0&_to=15`)}}}catch(t){return console.log(t),{success:!1,error:t}}},$.vtexRecs_getProducts=async function({source:t="recommendation",clusterId:e=null,campaignVrn:r="",products:a=null}){try{return"cluster"===t&&e?await $.vtexRecs_getClusterProducts(e):await $.vtexRecs_getRecommendations({campaignVrn:r,products:a})}catch(t){console.log(t)}},$.vtexRecs_exibirPercentualDesconto=function(t,e){try{return 5<=$.vtexRecs_getPercentualDesconto(t,e)}catch(t){console.log(t)}},$.vtexRecs_getPercentualDesconto=function(t,e){try{var r=e/t*100;return Math.round(100-r)}catch(t){console.log(t)}},$.vtexRecs_getFinalLayout=function(t){try{return 1===t?"highlight":2===t?"block":"compact"}catch(t){console.log(t)}},$.vtexRecs_getLimitSlice=function(t){try{var e=$(window).width()<1400;return 4===t?4:3===t?e?4:6:2===t?e?4:8:e?4:9}catch(t){console.log(t)}},$.vtexRecs_getImageSize=function(e,r="compact"){try{if(!e)return console.log("URL da imagem não fornecida"),"";let t="shelf-compact"===r?120:"shelf-default"===r?176:"highlight"===r?188:"block"===r?129:60;var a=/(\/ids\/\d+)(\/)/;return a.test(e)?e.replace(a,`$1-${t}-${t}$2`):e}catch(t){console.log(t)}},$.vtexRecs_getProductCard=function({product:e,isHighlight:r=!1,correlationId:a="",layout:o="compact"}){try{var c=e.link,s=e.productName,n=e.productId,i=$.vtexRecs_getImageSize(e.items[0].images[0].imageUrl,o),d=e.items[0].sellers.find(t=>t.sellerDefault),l=d.commertialOffer.Price,u=d.commertialOffer.ListPrice,m=d?.commertialOffer?.Teasers?.[0]?.["<Name>k__BackingField"]??null;let t='<a href="'+c+'" class="'+(r?"rnk-product-card highlight":"rnk-product-card")+'" data-product="'+n+'" data-correlation-id="'+a+'">';return t=(t=(t=r&&m?(t+='<div class="rnk-product-card-flags">')+'\t<p class="rnk-product-card-flag">'+m+"</p></div>":t)+('\t<img class="rnk-product-card-image img-fluid" src="'+i+'" alt="'+s+'" loading="lazy" />')+'\t<div class="rnk-product-card-infos">')+('\t\t<p class="rnk-product-card-name">'+s+"</p>")+'\t\t<div class="rnk-product-card-valores">',r&&l<u&&$.vtexRecs_exibirPercentualDesconto(u,l)?t=(t=(t+='\t\t<p class="rnk-product-card-valor-de"><del>'+$.maskMoney(u)+"</del></p>")+'\t\t<p class="rnk-product-card-valor-por"><ins>'+$.maskMoney(l)+"</ins></p>")+'\t\t<p class="rnk-product-card-valor-off">'+$.vtexRecs_getPercentualDesconto(u,l)+"% OFF</p>":t+='\t\t<p class="rnk-product-card-valor-por">'+$.maskMoney(l)+"</p>",t=(t+="\t\t</div>")+"\t</div>"+"</a>"}catch(t){console.log(t)}},$.vtexRecs_calcularValorCompreJunto=function(t){try{let e=0;return t.forEach(t=>{t=t.items[0].sellers.find(t=>t.sellerDefault);e+=t.commertialOffer.Price}),$.maskMoney(e)}catch(t){console.log(t)}},$.vtexRecs_getBtnBuyHrefCompreJunto=function(t){try{let r=[];return t.forEach(t=>{var e=t.items[0].itemId,t=t.items[0].sellers.find(t=>t.sellerDefault);r.push("sku="+e+"&qty=1&seller="+t.sellerId)}),"/checkout/cart/add?"+r.join("&")+"&redirect=true&sc=1"}catch(t){console.log(t)}},$.vtexRecs_bindAddToCartCompreJunto=function(t){try{var e=$(t);e.length&&e.each((t,e)=>{const a=$.btn(e);e=$(e);e.off("click"),e.on("click",function(t){t.preventDefault();const e=$(t.currentTarget);t=e.attr("href");e.addClass("disabled"),a.addLoading(),$.ajax({type:"GET",url:t,contentType:"application/json"}).done(r=>{a.addSuccess();try{$(".rnk-comp-compre-junto li").each((t,e)=>{t<2&&$.despacharEventoCustomizado("checkout:addToCart:done",{response:r,target:$(e).find('[class*="product-sku"]'),qty:1})})}catch(t){console.log(t)}try{$.header_atualizaQuantidadeItensCarrinho()}catch(t){console.log(t)}try{let r=[];$(".rnk-comp-compre-junto li").each((t,e)=>{t<2&&r.push($(e).find(".product-sku").text())}),$.header_exibirProdutoAdicionadoCarrinho.apply(null,r)}catch(t){console.log(t)}}).fail(()=>{a.removeLoading()}).always(()=>{e.removeClass("disabled")})})})}catch(t){console.log(t)}},$.vtexRecs_getPropertie=function(t,e){try{var r=t["properties"];if(r&&r.length&&e&&e.length){var a=r.filter(t=>t.name===e);if(a&&a.length)return a[0].values}return[]}catch(t){console.log(t)}},$.vtexRecs_getShelfItem=function(t,e="shelf-default",r=!1){try{var a=t.items[0],o=a.sellers.find(t=>t.sellerDefault),c=o?.commertialOffer?.Teasers?.[0]?.["<Name>k__BackingField"]??null;return $.shelf_getItem({name:a.nameComplete,skuId:a.itemId,price:o.commertialOffer.Price,listPrice:o.commertialOffer.ListPrice,url:t.link,imgUrl:$.vtexRecs_getImageSize(a.images[0].imageUrl,e),isAvailable:0<o.commertialOffer.AvailableQuantity,sellerId:o.sellerId,quantidadeUnitario:$.vtexRecs_getPropertie(t,"Quantidade"),sufixoUnidade:$.vtexRecs_getPropertie(t,"Sufixo R$/unidade"),entregaEspecial:$.vtexRecs_getPropertie(t,"Entrega Especiais"),tipoMedicamento:$.vtexRecs_getPropertie(t,"Tipo de Medicamento"),classeMedicamento:$.vtexRecs_getPropertie(t,"Classe do Medicamento"),prescricaoMedica:$.vtexRecs_getPropertie(t,"Prescrição Médica"),valorDescontoMinimo:$.vtexRecs_getPropertie(t,"Valor Desconto Minimo"),descontoPromocao:$.vtexRecs_getPropertie(t,"Descontos e Promoções"),pbmAutorizadora:$.vtexRecs_getPropertie(t,"PBM"),pbmPrograma:$.vtexRecs_getPropertie(t,"PBM Programa"),pds:$.vtexRecs_getPropertie(t,"PDS"),flagsDiscount:c,nomeCategoria:t.categories||[],nomeMarca:t.brand||[],preVenda:[],isSplideItem:r})}catch(t){console.log(t)}},$.vtexAds_getValidCards=function(t){try{const r=t.filter(({response:t})=>{return 0<(t?.data?.products??[]).length});return 0===r.length?[]:r.filter(({response:t})=>{var t=t.data.products.length,e=r.length;return 4===e?3<t:3===e?5<t:2===e?7<t:8<t})}catch(t){return[]}},$.vtexRecs_renderCards=async function(t){try{var e=t.data()["cards"];if(!e||!e.length)return t.addClass("d-none");var r=e.map(async({title:t,titleStrong:e,svg:r,layout:a="compact",campaignVrn:o,source:c="recommendation",clusterId:s=null,products:n=null})=>{return{title:t,titleStrong:e,svg:r,layout:a,source:c,response:await $.vtexRecs_getProducts({source:c,campaignVrn:o,clusterId:s,products:n})}}),a=(await Promise.allSettled(r)).filter(t=>"fulfilled"===t.status).map(t=>t.value);const l=$.vtexAds_getValidCards(a);if(0===l.length)return t.addClass("d-none");let d="";d=(d=d+'<div class="container-lg rnk-container-cards-produtos-recomendados">'+'\t<div class="row">')+'\t\t<div class="col-12">'+'\t\t\t<div class="rnk-comp-cards-produtos-recomendados">',l.forEach(({title:t,titleStrong:e,svg:r,source:a,response:o})=>{var c=o.data.products;const s=$.vtexRecs_getFinalLayout(c.length),n=o.data.correlationId;var i=c.map(t=>String(t.productId)).join(",");d=(d=(d+='<div class="card" data-source="'+a+'" data-correlation-id="'+n+'" data-products="'+i+'">')+'\t<div class="card-header">\t\t<h3 class="card-title">')+(t??o.data.campaign.title),e&&(d+=' <strong class="d-block">'+e+"</strong>"),d+="\t\t</h3>",d=(d=r?(d+='<div class="rnk-box-icon">')+'\t<i class="'+r+'"></i></div>':d)+'\t</div>\t<div class="card-body">',"highlight"===s?d+=$.vtexRecs_getProductCard({product:c[0],isHighlight:!0,correlationId:n,layout:s}):(a=$.vtexRecs_getLimitSlice(l.length),d+='<ul class="rnk-list-product-card rnk-list-product-card-'+s+' list-unstyled">',c.slice(0,a).forEach(t=>{d+="<li>"+$.vtexRecs_getProductCard({product:t,correlationId:n,layout:s})+"</li>"}),d+="</ul>"),d+="\t</div></div>"}),d=(d=d+"\t\t\t</div>"+"\t\t</div>")+"\t</div>"+"</div>",t.html(d),$.vtexRecs_bindRecommendationClick(".rnk-comp-cards-produtos-recomendados .rnk-product-card"),$.vtexRecs_bindRecommendationView(".rnk-comp-cards-produtos-recomendados > .card")}catch(t){console.log(t)}},$.vtexRecs_renderSimilares=async function(t){try{const{campaignVrn:i,title:d,compact:l=!1,splide:u=!1}=t.data();var{success:e,data:r}=await $.vtexRecs_getRecommendations({campaignVrn:i,products:PDP_PRODUCT_SKU});if(!e||!r.products.length)return t.addClass("d-none");var a=l?6:5,o=r.products.slice(0,a);if(!(o.length<a)){const m=l?"shelf-compact":"shelf-default";var c=["rnk-container-prateleira","rnk-container-vtex-recommendations-prateleira","rnk-container-vtex-recommendations-similares"],s=r.correlationId,n=o.map(t=>String(t.productId)).join(",");l&&c.push("rnk-container-prateleira-compacta");let e="";e=(e=(e=(e+='<div class="container-lg '+c.join(" ")+'" data-correlation-id="'+s+'" data-products="'+n+'">')+'\t<div class="row">'+'\t\t<div class="col-12">')+('\t\t\t<h2 class="h4 mb-4">'+(d||r.campaign.title)+"</h2>"))+'\t\t\t<div class="prateleira vitrine default">'+"\t\t\t\t<ul>",o.forEach(t=>{e+=$.vtexRecs_getShelfItem(t,m,u)}),e=(e=(e+="\t\t\t\t</ul>")+"\t\t\t</div>"+"\t\t</div>")+"\t</div>"+"</div>",t.html(e);try{u?($.shelf_estruturarSplide(t.find(".prateleira"),{type:"slide",autoplay:!1,pagination:!1,arrows:o.length>a,perPage:l?6:5,perMove:1,breakpoints:{1400:{arrows:o.length>a,perPage:l?6:5},1200:{arrows:4<o.length,perPage:4},992:{arrows:o.length>(l?4:3),perPage:l?4:3},576:{arrows:2<o.length,perPage:2},360:{arrows:1<o.length,perPage:1}}}),$.shelf_executarAntesDeRedirecionar(t.find('li:not(.splide__slide--clone):not(.click-success) a:not([href*="checkout"])'))):$.shelf_executarFuncoes()}catch(t){console.log(t)}$.vtexRecs_bindRecommendationView(".rnk-container-vtex-recommendations-similares")}}catch(t){console.log(t)}},$.vtexRecs_renderCompreJunto=async function(t){try{var{campaignVrn:e,title:r}=t.data(),a=await $.getProduct("?fq=skuId:"+PDP_PRODUCT_SKU);const{success:s,data:i}=await $.vtexRecs_getRecommendations({campaignVrn:e,products:PDP_PRODUCT_SKU});if(!s||!i?.products?.length||!a?.length)return t.addClass("d-none");var o=[a[0],i.products[0]],c=o.map(t=>String(t.productId)).join(",");let n="";n=(n=(n=n+('<div class="rnk-container-vtex-recommendations-compre-junto" data-correlation-id="'+i.correlationId+'" data-products="'+c+'">')+'\t<div class="row">')+'\t\t<div class="col-12">'+'\t\t\t<div class="rnk-comp-compre-junto">')+('\t\t\t\t<h2 class="h4 mb-4">'+(r||i.campaign.title)+"</h2>")+"\t\t\t\t<ul>",o.forEach((t,e)=>{var r=t.productName,a=t.items[0].itemId,o=t.link,c=t.items[0].sellers.find(t=>t.sellerDefault),s=c.commertialOffer.ListPrice,c=c.commertialOffer.Price,e=0===e?"plus":"equals";n=(n=(n=(n=(n=(n=(n+='<li class="rnk-comprejunto-ch rnk-comprejunto-ch-produto">')+'\t<p class="product-sku" style="display:none;">'+a+'</p>\t<div class="img-prateleira">')+'\t\t<a href="'+o+'" data-product="'+t.productId+'" data-correlation-id="'+i.correlationId+'">')+'\t\t\t<img class="img-fluid" src="'+$.vtexRecs_getImageSize(t.items[0].images[0].imageUrl,"shelf-default")+'" alt="'+r+'" loading="lazy" />\t\t</a>')+'\t</div>\t<div class="d-flex flex-column flex-grow-1">')+'\t\t<div class="trustvox-widget-rating" data-trustvox-product-code="'+a+'"></div>\t\t<div class="descricao-prateleira">')+'\t\t\t<a href="'+o+'" class="collection-link" data-product="'+t.productId+'" data-correlation-id="'+i.correlationId+'">'+r+'</a>\t\t\t<p class="price">',c<s&&$.vtexRecs_exibirPercentualDesconto(s,c)&&(n+='<a href="'+o+'" class="valor-de" data-product="'+t.productId+'" data-correlation-id="'+i.correlationId+'">'+$.maskMoney(s)+"</a>"),n=(n=(n=n+('\t\t\t\t<a href="'+o+'" class="valor-por" data-product="'+t.productId+'" data-correlation-id="'+i.correlationId+'">'+$.maskMoney(c))+"</a>\t\t\t</p>")+"\t\t</div>\t</div>")+'\t<span class="icon-round"><span><i class="fal fa-'+e+'"></i></span></span></li>'}),n=(n=(n=(n=(n=(n=(n=(n=(n=(n=n+'\t\t\t\t\t<li class="rnk-comprejunto-ch totals-ch">'+'\t\t\t\t\t\t<div class="items-msg">')+'\t\t\t\t\t\t\t<h2>Compre junto <span class="d-block item-colored text-info">No valor de</span></h2>'+"\t\t\t\t\t\t</div>")+'\t\t\t\t\t\t<div class="items-total-price">'+'\t\t\t\t\t\t\t<div class="items-total-price-wrap">')+('\t\t\t\t\t\t\t\t<span class="vlr-por">'+$.vtexRecs_calcularValorCompreJunto(o)+"</span>")+"\t\t\t\t\t\t\t</div>")+('\t\t\t\t\t\t\t<a target="_top" class="btn btn-primary rnk-btn-between chaordic-buy-button w-100" href="'+$.vtexRecs_getBtnBuyHrefCompreJunto(o)+'">'))+"\t\t\t\t\t\t\t\tCompre junto"+'\t\t\t\t\t\t\t\t<i class="fal fa-shopping-basket"></i>')+"\t\t\t\t\t\t\t</a>"+"\t\t\t\t\t\t</div>")+"\t\t\t\t\t</li>"+"\t\t\t\t</ul>")+"\t\t\t</div>"+"\t\t</div>")+"\t</div>"+"</div>",t.html(n),$.vtexRecs_bindAddToCartCompreJunto(".rnk-comp-compre-junto .chaordic-buy-button"),$.vtexRecs_bindRecommendationClick(".rnk-comp-compre-junto .rnk-comprejunto-ch-produto a"),$.vtexRecs_bindRecommendationView(".rnk-container-vtex-recommendations-compre-junto")}catch(t){console.log(t)}},$.vtexRecs_renderRecommendations=async function(){try{for(const r of Array.from($(".rnk-container-vtex-recommendations"))){var t=$(r),e=t.attr("data-component")??"cards";"cards"===e&&await $.vtexRecs_renderCards(t),"similares"===e&&await $.vtexRecs_renderSimilares(t),"compre-junto"===e&&await $.vtexRecs_renderCompreJunto(t)}}catch(t){console.log(t)}};