function LiveshopAdsUserDevice(){const e=navigator.userAgent;return{tipo:/Mobi/i.test(e)?"mobile":"desktop",sistemaOperacional:{name:/Windows/i.test(e)?"Windows":/Mac/i.test(e)?"MacOS":/X11/i.test(e)?"UNIX":/Linux/i.test(e)?"Linux":/Android/i.test(e)?"Android":/iPhone|iPad|iPod/i.test(e)?"iOS":"Unknown"},especificacao:{type:/Mobi/i.test(e)?"mobile":"desktop",brand:/iPhone|iPad|iPod/i.test(e)?"Apple":/Android/i.test(e)?"Android":"Unknown",isMobileDevice:/Mobi/i.test(e)},navegador:(()=>{const i=e.match(/(Opera|Chrome|Safari|Firefox|MSIE|Trident)\/?\s*(\d+)/i)||[],t=e.match(/version\/(\d+)/i),s="MSIE"===i[1]||"Trident"===i[1]?"Internet Explorer":i[1],o=t?t[1]:i[2];return{name:s||"Unknown",version:o||"Unknown",versionMajor:o||"Unknown"}})()}}var __awaiter=this&&this.__awaiter||function(e,i,t,s){return new(t||(t=Promise))(function(o,r){function n(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t(function(e){e(i)})).then(n,a)}l((s=s.apply(e,i||[])).next())})};class LiveshopAdsCarouselV2 extends HTMLElement{constructor(){super(),this.localStorageUserIdKey="LiveshopAds_UserId",this.API_PUBLIC="https://public.streamshop.com.br/api",this.API_DADOS="https://data-queue.streamshop.com.br/prod",this.slugsVideo="",this.reelsSlugsVideo="",this.marketplaceReels=!1,this.emitImpressionEvent=!1,this.opacity="0.5",this.borderRadius="12px",this.videosFromStore="",this.name="",this.height="unset",this.origin="",this.user=null,this.userId=null,this.quality="mq",this.theme="light",this.aspectRatio="9/16",this.hml=!1,this.embedded=!1,this.skipTerms=!0,this.useLegacyOverlay=!1,this.showLogo=!1,this.isVideoCommerce=!0,this.overlayPosition="right",this.useActiveVideosFrom="",this.anonymousUser={nome:"Usuário não identificado",localizacao:null,dispositivo:eval("LiveshopAdsUserDevice()"),role:1},this.useTags="",this.attachShadow({mode:"open"})}static get observedAttributes(){return["slugs-video","quality","theme","hml","slugs-reels","marketplace-reels","use-post-message","embedded","aspect-ratio","skip-terms","use-legacy-overlay","videos-from-store","origin","name","show-logo","use-active-videos-from","is-video-commerce","height","use-tags","emit-impression-event","overlay-position","opacity","border-radius"]}attributeChangedCallback(e,i,t){null!==t&&("slugs-video"===e&&(this.slugsVideo=t),"videos-from-store"===e&&(this.videosFromStore=t),"origin"===e&&(this.origin=t),"name"===e&&(this.name=t),"quality"===e&&(this.quality=t),"theme"===e&&(this.theme=t),"hml"===e&&(this.hml="true"===t),"slugs-reels"===e&&(this.reelsSlugsVideo=t),"marketplace-reels"===e&&(this.marketplaceReels="true"===t),"use-post-message"===e&&(this.usePostMessage="true"===t),"embedded"===e&&(this.embedded="true"===t),"aspect-ratio"===e&&(this.aspectRatio=t),"skip-terms"===e&&(this.skipTerms="true"===t),"use-legacy-overlay"===e&&(this.useLegacyOverlay="true"===t),"show-logo"===e&&(this.showLogo="true"===t),"use-active-videos-from"===e&&(this.useActiveVideosFrom=t),"is-video-commerce"===e&&(this.isVideoCommerce="true"===t),"height"===e&&(this.height=t),"use-tags"===e&&(this.useTags=t),"emit-impression-event"===e&&(this.emitImpressionEvent="true"===t),"overlay-position"===e&&(this.overlayPosition=t),"opacity"===e&&(this.opacity=t),"border-radius"===e&&(this.borderRadius=t))}connectedCallback(){this.render()}normalizeEnvironment(){this.hml&&(this.API_PUBLIC="https://public-hml.streamshop.com.br/api",this.API_DADOS="https://data-queue.streamshop.com.br/hml")}convertStringToJson(e){return JSON.parse(e.replace(/'/g,'"'))}render(){return __awaiter(this,void 0,void 0,function*(){if(!this.slugsVideo&&!this.videosFromStore&&!this.useActiveVideosFrom)return;this.normalizeEnvironment(),yield this.loadSwiperScript();const e=yield this.fetchAllCarouselAds();(null==e?void 0:e.length)<3||(this.videosFromStore?(null==e?void 0:e.length)&&(this.slugsVideo=e.map(e=>e.slug).join(","),this.createDefaultReels()):this.useActiveVideosFrom?((null==e?void 0:e.length)>1&&(this.slugsVideo=e.map(e=>e.slug).join(",")),this.createDefaultReels()):this.reelsSlugsVideo||this.createDefaultReels(),this.createReelsInCarousel(),yield this.getUser(),this.emitImpressionEvent&&this.doImpressionEventToAllAds(e),this.buildHtml(e))})}loadSwiperScript(){return __awaiter(this,void 0,void 0,function*(){return new Promise((e,i)=>{if(void 0!==window.Swiper)return void e();const t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/swiper@11.2.10/swiper-bundle.min.js",t.onload=()=>e(),t.onerror=e=>i(e),document.head.appendChild(t)})})}buildHtml(e){this.shadowRoot.innerHTML=(null==e?void 0:e.length)?`\n <style> \n @charset "UTF-8";@import url(https://cdn.jsdelivr.net/npm/swiper@11.2.10/swiper-bundle.min.css);*{margin:0;padding:0;box-sizing:border-box}.swiper-container{width:100%;max-width:1399px;margin:0 auto;min-height:500px;position:relative}.swiper{width:100%;height:100%}.swiper-wrapper{align-items:center}.swiper-slide{overflow:hidden;transition:all .3s ease;display:flex;align-items:center;justify-content:center;aspect-ratio:9/16;max-height:500px;user-select:none}.swiper-slide-active{opacity:1!important;transform:scale(1)!important;z-index:2}.swiper-button-next,.swiper-button-prev{width:32px;height:32px;border-radius:50%;background:rgba(0,0,0,.3);border-radius:16px;backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);border:1px solid rgba(133,133,133,.3);transition:all .3s ease;top:50%;transform:translateY(-50%)}.swiper-button-next::after,.swiper-button-prev::after{content:""!important}.swiper-button-next::before,.swiper-button-prev::before{content:"";width:10px;height:10px;border-top:2px solid #fff;border-right:2px solid #fff;display:block}.swiper-button-prev::before{transform:rotate(-135deg);margin-right:-5px}.swiper-button-next::before{transform:rotate(45deg);margin-left:-5px}.swiper-button-next:hover,.swiper-button-prev:hover{background:#262626;transform:scale(1.1);top:50%;transform:translateY(-50%)}.swiper-button-prev{left:3px}.swiper-button-next{right:3px} \n </style>\n \n\n <style>\n :host{\n display: block;\n max-height: ${this.height};\n }\n \n \n .swiper-horizontal, .swiper-container {\n max-height: ${this.height};\n }\n \n \n /* Estilo para slides não ativos */\n .swiper-slide:not(.swiper-slide-active) {\n opacity: ${this.opacity};\n transform: scale(0.9);\n }\n\n .swiper-slide {\n border-radius: ${this.borderRadius};\n }\n\n </style>\n \n <div class="swiper-container" >\n <div class="swiper">\n <div class="swiper-wrapper" id="swiper-wrapper">\n ${Array(3).fill(e.map((e,i)=>{var t;return`\n <div data-original-index="${i}" class="swiper-slide"> \n <liveshop-ads-video \n aspect-ratio="${this.aspectRatio}"\n ads-in-swiper="true" \n theme="${this.theme}" \n border-radius="${this.borderRadius}"\n ads-video-object="${this.convertJsonToString(e)}" \n overlay-position="${this.overlayPosition}"\n slug-video="${e.slugVideo||e.slug||"LIVESHOP_VIDEO_ERROR"}" \n is-video-commerce="${this.isVideoCommerce}"\n carousel-height="${this.height}"\n is-carousel-v2="true"\n ${(null===(t=this.reelsSlugsVideoPlaylist)||void 0===t?void 0:t[i])?`slugs-reels="${this.reelsSlugsVideoPlaylistFormat(this.reelsSlugsVideoPlaylist[i])}"`:""}\n ${this.user?`user="${this.convertJsonToString(this.user)}"`:""} \n ${this.checkHideContent()?'hide-content="true"':""} \n ${this.hml?'hml="true"':""} \n ${this.marketplaceReels?'marketplace-reels="true"':""}\n ${this.usePostMessage?'use-post-message="true"':""} \n ${this.embedded?'embedded="true"':""} \n ${this.skipTerms?'skip-terms="true"':""} \n ${this.useLegacyOverlay?'use-legacy-overlay="true"':""}\n ${this.showLogo?'show-logo="true"':""}\n ${this.useActiveVideosFrom?'use-active-videos-from="true"':""}\n ${this.emitImpressionEvent?'emit-impression-event="true"':""}\n \n \n ></liveshop-ads-video>\n </div>\n `}).join("")).flat()}\n </div>\n \x3c!-- Setas de navegação --\x3e\n <div class="swiper-button-next"></div>\n <div class="swiper-button-prev"></div>\n </div>\n </div>\n `:"",this.initializeSwiper(e)}checkHideContent(){if("unset"===this.height)return!1;const e=parseInt(this.height,10);return!isNaN(e)&&!(e>=180)}initializeSwiper(e){let i,t;const s=()=>{var e;const i=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector(".swiper-container");if(!i)return 1.2;const t=i.clientWidth;return t>=650?5:t>=450?3:1.2},o=e=>{var i;const t=null===(i=this.shadowRoot)||void 0===i?void 0:i.querySelector(".swiper");t&&(t.style.padding=e<=1.5?"0 30px":"0")},r=e=>{var i,t;const s=null===(i=this.shadowRoot)||void 0===i?void 0:i.querySelector(".swiper-button-next"),o=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector(".swiper-button-prev");s&&o&&(e>=3?(s.style.display="flex",o.style.display="flex"):(s.style.display="none",o.style.display="none"))},n=()=>{var e;const t=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector(".swiper-container");if(!t||!window.ResizeObserver)return;new ResizeObserver(e=>{for(let t of e)if(i&&!i.destroyed){const e=s(),t=i.params.slidesPerView;Math.abs(e-t)>.1&&(i.params.slidesPerView=e,i.update(),o(e),r(e),console.log("Slides por view atualizado para:",e))}}).observe(t)},a=()=>{var e,i,t;const o=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelectorAll(".swiper-slide"),r=null===(i=this.shadowRoot)||void 0===i?void 0:i.querySelector(".swiper-container");if(!r)return;const n=r.clientWidth,a=s(),l=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector(".swiper"),d=window.getComputedStyle(l),u=16*((n-(parseFloat(d.paddingLeft)||0)-(parseFloat(d.paddingRight)||0))/a)/9,h=Math.min(u,500);r.style.height=h+"px",o.forEach(e=>{e.style.maxHeight=h+"px"})};(()=>{const t=s(),a=this.shadowRoot.querySelector(".swiper"),l=this.shadowRoot.querySelector(".swiper-button-next"),d=this.shadowRoot.querySelector(".swiper-button-prev");i=new window.Swiper(a,{direction:"horizontal",loop:!0,centeredSlides:!0,speed:400,grabCursor:!0,allowTouchMove:!0,simulateTouch:!0,touchRatio:1,touchAngle:45,slideToClickedSlide:!0,autoplay:{delay:5e3,disableOnInteraction:!1,pauseOnMouseEnter:!0},navigation:{nextEl:l,prevEl:d},slidesPerView:t,spaceBetween:8,initialSlide:2*e.length,on:{init:function(){console.log("Swiper inicializado com",t,"slides por view"),setTimeout(()=>{this.slideToLoop(2,0)},100),o(t),r(t)},slidesPerViewChange:function(){o(this.params.slidesPerView),r(this.params.slidesPerView)}}});this.shadowRoot.querySelectorAll(".swiper-slide").forEach(e=>{e.addEventListener("click",e=>{let t=e.target;for(;t&&!t.hasAttribute("data-original-index");)t=t.parentElement;if(t){const e=parseInt(t.getAttribute("data-original-index"));i.slideToLoop(e)}})}),n()})(),window.addEventListener("resize",()=>{clearTimeout(t),t=setTimeout(()=>{if(a(),i&&!i.destroyed){const e=s();Math.abs(e-i.params.slidesPerView)>.1&&(i.params.slidesPerView=e,i.update(),o(e),r(e))}},100)}),setTimeout(()=>a(),1e3)}createDefaultReels(){try{const e=this.slugsVideo.replace(/\s/g,"").split(",");this.reelsSlugsVideo=e.map(i=>`[${i},${e.filter(e=>e!==i)}]`).join(";")}catch(e){console.error("Erro ao montar a playlist de reels DEFAULT:",e)}}doImpressionEventToAllAds(e){fetch(`${this.API_DADOS}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.map(e=>({attributeValue:"StreamAdsImpressionEvent",lojaId:e.storeId,lojaMatrizId:e.mainStoreId,usuarioId:this.userId,videoId:e.videoId,data:new Date})))})}reelsSlugsVideoPlaylistFormat(e){return JSON.stringify(e).replace(/"/g,"'")}createReelsInCarousel(){try{let e=this.reelsSlugsVideo.split(";");this.reelsSlugsVideoPlaylist=e.map(e=>{let i=e.trim();return"[]"===i?[]:i.slice(1,-1).split(",").filter(e=>!!e)})}catch(e){console.error("Erro ao criar a playlist de reels:",e)}}convertJsonToString(e){return JSON.stringify(e).replace(/"/g,"LIVESHOP_ADS_QUOTES_REPLACE")}fetchAllCarouselAds(){return __awaiter(this,void 0,void 0,function*(){try{const e=new URLSearchParams;this.videosFromStore?(e.append("origin",this.origin||(window.top||window).location.href),e.append("storeSlug",this.videosFromStore),e.append("tagName",this.name)):this.slugsVideo?e.append("slugs",this.slugsVideo):this.useActiveVideosFrom&&(e.append("storeSlug",this.useActiveVideosFrom),e.append("onlyActives","true"),this.useTags&&e.append("filterByTags",this.useTags)),e.append("quality",this.quality);const i=yield fetch(`${this.API_PUBLIC}/video/ads?${e.toString()}`);return yield i.json()}catch(e){return console.error("Erro ao buscar video:",e),[]}})}getUser(){return __awaiter(this,void 0,void 0,function*(){var e,i,t,s,o,r;try{const n=localStorage.getItem(this.localStorageUserIdKey);if(n&&"undefined"!==n){const a=yield this.fetchUserById(n);try{this.userId=null!==(s=null!==(i=null===(e=this.convertStringToJson(a))||void 0===e?void 0:e.usuarioId)&&void 0!==i?i:null===(t=null==a?void 0:a.findUser)||void 0===t?void 0:t.id)&&void 0!==s?s:null}catch(e){this.userId=null!==(r=null===(o=null==a?void 0:a.findUser)||void 0===o?void 0:o.id)&&void 0!==r?r:null}return this.user=null!=a?a:null,this.user}{if(!(yield this.createUser()))return null;const e=this.userId||localStorage.getItem(this.localStorageUserIdKey);if(!e)return null;const i=yield this.fetchUserById(e);return this.user=null!=i?i:null,this.user}}catch(e){return console.error("[ LIVESHOP ADS VIDEO ] Não foi possível obter o usuário",e),this.user=null,null}})}fetchUserById(e){return __awaiter(this,void 0,void 0,function*(){var i,t;const s={method:"POST",body:JSON.stringify({query:"\n query findUserQuery($id: String!) {\n findUser(id: $id) {\n id\n nome\n role\n metaDados {\n localizacao {\n codigoPais\n nomePais\n codigoEstado\n nomeEstado\n nomeCidade\n cep\n }\n dispositivo {\n navegador { name version versionMajor }\n especificacao { brand isMobileDevice type }\n sistemaOperacional { name }\n tipo\n }\n }\n banido\n email\n }\n }",variables:{id:e}})},o=yield fetch(this.API_PUBLIC+"/graphql",s),r=yield o.json();return null!==(t=null!==(i=null==r?void 0:r.data)&&void 0!==i?i:r)&&void 0!==t?t:null})}getUserLocation(){return __awaiter(this,void 0,void 0,function*(){try{const e=yield fetch("https://aws-headers.streamshop.com.br"),i=yield e.json();this.anonymousUser.localizacao=(null==i?void 0:i.cloudFrontViewerCity)?{cep:i.cloudFrontViewerPostalCode,codigoEstado:i.cloudFrontViewerCountryRegion,codigoPais:i.cloudFrontViewerCountry,nomeCidade:i.cloudFrontViewerCity,nomeEstado:i.cloudFrontViewerCountryRegionName}:null}catch(e){console.error("[ LIVESHOP ADS VIDEO ] Não foi possível obter a localização do usuário")}})}createUser(){return __awaiter(this,void 0,void 0,function*(){var e,i,t,s,o,r,n,a;try{yield this.getUserLocation();const l={method:"POST",body:JSON.stringify({query:"\n mutation createUserMutation($id: String, $nome: String!, $role: Int!, $metaDados: MetaDadosUsuarioInput) {\n createUser(id: $id, nome: $nome, role: $role, metaDados: $metaDados) {\n id\n nome\n role\n metaDados {\n localizacao {\n codigoPais\n nomePais\n codigoEstado\n nomeEstado\n nomeCidade\n cep\n }\n dispositivo {\n navegador { name version versionMajor }\n especificacao { brand isMobileDevice type }\n sistemaOperacional { name }\n tipo\n }\n }\n banido\n email\n }\n }",variables:this.anonymousUser})},d=yield fetch(this.API_PUBLIC+"/graphql",l),u=yield d.text(),h=JSON.parse(u),c=null!==(o=null!==(t=null===(i=null===(e=null==h?void 0:h.data)||void 0===e?void 0:e.createUser)||void 0===i?void 0:i.id)&&void 0!==t?t:null===(s=null==h?void 0:h.createUser)||void 0===s?void 0:s.id)&&void 0!==o?o:null;return!!c&&(localStorage.setItem(this.localStorageUserIdKey,c),this.userId=c,this.user=null!==(a=null!==(n=null===(r=null==h?void 0:h.data)||void 0===r?void 0:r.createUser)&&void 0!==n?n:null==h?void 0:h.createUser)&&void 0!==a?a:null,!0)}catch(e){return console.error("[ LIVESHOP ADS VIDEO ] Erro ao criar usuário",e),!1}})}}customElements.define("liveshop-ads-carousel-v2",LiveshopAdsCarouselV2);