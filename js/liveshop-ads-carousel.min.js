function LiveshopAdsSwiper(e,s,i,t,o){let r,n,a,l,d,h,u=!1,c=o,p=0;function v(s){e.scrollBy({left:"left"===s?-m(t):m(t),behavior:"smooth"}),setTimeout(()=>g(),300),setTimeout(()=>g(),600)}function m(e){const s=e.match(/[\d.]+/);return s?parseFloat(s[0]):200}function g(){e.scrollLeft<=0?s.style.display="none":s.style.display="flex",e.scrollLeft+e.clientWidth>=e.scrollWidth-10?i.style.display="none":i.style.display="flex"}function y(){function t(s,i){s.stopPropagation(),a=!1,u=!0;const t=i?s.touches[0].pageX:s.pageX,o=i?s.touches[0].pageY:s.pageY;r=t,startY=o,n=e.scrollLeft,e.style.cursor="grabbing",h&&(clearInterval(h),h=null),l=r,d=startY,p=0}function o(){u&&(!a&&c&&c(),u=!1,e.style.cursor="grab",function(){if(h)return;h=setInterval(()=>{if(Math.abs(p)<.5)return clearInterval(h),void(h=null);e.scrollLeft-=p,p*=.95,g()},16)}())}function m(s,i){if(a=!0,!u)return;const t=i?s.touches[0].pageX:s.pageX,o=i?s.touches[0].pageY:s.pageY,h=t-l,c=o-d;if(Math.abs(h)>Math.abs(c)){const s=t-r;e.scrollLeft=n-s,p=h,l=t,d=o}else l=t}e.addEventListener("mousedown",e=>t(e,!1)),e.addEventListener("touchstart",e=>t(e,!0)),e.addEventListener("mouseleave",o),e.addEventListener("mouseup",o),e.addEventListener("touchend",o),e.addEventListener("mousemove",e=>m(e,!1)),e.addEventListener("touchmove",e=>m(e,!0)),s.addEventListener("click",()=>v("left")),i.addEventListener("click",()=>v("right"))}setTimeout(()=>{y(),g()},0)}function LiveshopAdsUserDevice(){const e=navigator.userAgent;return{tipo:/Mobi/i.test(e)?"mobile":"desktop",sistemaOperacional:{name:/Windows/i.test(e)?"Windows":/Mac/i.test(e)?"MacOS":/X11/i.test(e)?"UNIX":/Linux/i.test(e)?"Linux":/Android/i.test(e)?"Android":/iPhone|iPad|iPod/i.test(e)?"iOS":"Unknown"},especificacao:{type:/Mobi/i.test(e)?"mobile":"desktop",brand:/iPhone|iPad|iPod/i.test(e)?"Apple":/Android/i.test(e)?"Android":"Unknown",isMobileDevice:/Mobi/i.test(e)},navegador:(()=>{const s=e.match(/(Opera|Chrome|Safari|Firefox|MSIE|Trident)\/?\s*(\d+)/i)||[],i=e.match(/version\/(\d+)/i),t="MSIE"===s[1]||"Trident"===s[1]?"Internet Explorer":s[1],o=i?i[1]:s[2];return{name:t||"Unknown",version:o||"Unknown",versionMajor:o||"Unknown"}})()}}var __awaiter=this&&this.__awaiter||function(e,s,i,t){return new(i||(i=Promise))(function(o,r){function n(e){try{l(t.next(e))}catch(e){r(e)}}function a(e){try{l(t.throw(e))}catch(e){r(e)}}function l(e){var s;e.done?o(e.value):(s=e.value,s instanceof i?s:new i(function(e){e(s)})).then(n,a)}l((t=t.apply(e,s||[])).next())})};class LiveshopAdsCarousel extends HTMLElement{constructor(){super(),this.localStorageUserIdKey="LiveshopAds_UserId",this.liveshopAdsCarouselId=window.crypto.randomUUID(),this.API_PUBLIC="https://public.streamshop.com.br/api",this.API_DADOS="https://data-queue.streamshop.com.br/prod",this.slugsVideo="",this.reelsSlugsVideo="",this.marketplaceReels=!1,this.videosFromStore="",this.name="",this.origin="",this.user=null,this.userId=null,this.quality="mq",this.theme="light",this.videosWidth="200px",this.width="100%",this.height="100%",this.gap="12px",this.aspectRatio="9/16",this.hml=!1,this.borderRadius="16px",this.embedded=!1,this.skipTerms=!0,this.useLegacyOverlay=!1,this.storiesStyle=!1,this.storiesSize=null,this.storiesColor=null,this.showLogo=!1,this.isVideoCommerce=!0,this.useActiveVideosFrom="",this.anonymousUser={nome:"Usuário não identificado",localizacao:null,dispositivo:eval("LiveshopAdsUserDevice()"),role:1},this.useTags="",this.emitImpressionEvent=!1,this.overlayPosition="right",this.swiperNextBtnId=window.crypto.randomUUID(),this.swiperPreviousBtnId=window.crypto.randomUUID(),this.attachShadow({mode:"open"})}static get observedAttributes(){return["slugs-video","width","height","videos-width","quality","theme","hml","border-radius","slugs-reels","marketplace-reels","use-post-message","embedded","aspect-ratio","gap","skip-terms","use-legacy-overlay","videos-from-store","origin","name","stories-style","stories-size","stories-color","show-logo","use-active-videos-from","is-video-commerce","use-tags","emit-impression-event","overlay-position"]}attributeChangedCallback(e,s,i){null!==i&&("slugs-video"===e&&(this.slugsVideo=i),"videos-from-store"===e&&(this.videosFromStore=i),"origin"===e&&(this.origin=i),"height"===e&&(this.height=i),"width"===e&&(this.width=i),"name"===e&&(this.name=i),"videos-width"===e&&(this.videosWidth=i),"quality"===e&&(this.quality=i),"theme"===e&&(this.theme=i),"hml"===e&&(this.hml="true"===i),"border-radius"===e&&(this.borderRadius=i),"slugs-reels"===e&&(this.reelsSlugsVideo=i),"marketplace-reels"===e&&(this.marketplaceReels="true"===i),"use-post-message"===e&&(this.usePostMessage="true"===i),"embedded"===e&&(this.embedded="true"===i),"aspect-ratio"===e&&(this.aspectRatio=i),"gap"===e&&(this.gap=i),"skip-terms"===e&&(this.skipTerms="true"===i),"use-legacy-overlay"===e&&(this.useLegacyOverlay="true"===i),"stories-style"===e&&(this.storiesStyle="true"===i),"stories-size"===e&&(this.storiesSize=i),"stories-color"===e&&(this.storiesColor=i),"show-logo"===e&&(this.showLogo="true"===i),"use-active-videos-from"===e&&(this.useActiveVideosFrom=i),"is-video-commerce"===e&&(this.isVideoCommerce="true"===i),"use-tags"===e&&(this.useTags=i),"emit-impression-event"===e&&(this.emitImpressionEvent="true"===i),"overlay-position"===e&&(this.overlayPosition=i))}connectedCallback(){this.render()}normalizeEnvironment(){this.hml&&(this.API_PUBLIC="https://public-hml.streamshop.com.br/api",this.API_DADOS="https://data-queue.streamshop.com.br/hml")}convertStringToJson(e){return JSON.parse(e.replace(/'/g,'"'))}getHideContentClass(){return this.width.endsWith("px")&&parseInt(this.width)<249||this.height.endsWith("px")&&parseInt(this.height)<249?"--hide-content":""}render(){return __awaiter(this,void 0,void 0,function*(){if(!this.slugsVideo&&!this.videosFromStore&&!this.useActiveVideosFrom)return;this.storiesStyle&&(this.storiesSize=this.storiesSize||"80px",this.storiesColor=this.storiesColor||"#c654ff"),this.normalizeEnvironment();const e=yield this.fetchAllCarouselAds();this.videosFromStore?(null==e?void 0:e.length)&&(this.slugsVideo=e.map(e=>e.slug).join(","),this.createDefaultReels()):this.useActiveVideosFrom?((null==e?void 0:e.length)>1&&(this.slugsVideo=e.map(e=>e.slug).join(",")),this.createDefaultReels()):this.reelsSlugsVideo||this.createDefaultReels(),this.createReelsInCarousel(),yield this.getUser(),this.emitImpressionEvent&&this.doImpressionEventToAllAds(e),this.shadowRoot.innerHTML=(null==e?void 0:e.length)?`\n <style> :host{display:block;width:100%}.liveshop-ads-carousel{box-sizing:border-box;display:flex;position:relative;padding:0 22px}@media (max-width:576px){.liveshop-ads-carousel{padding:0}.liveshop-ads-carousel>.swiper-ads-controls{display:none}}.liveshop-ads-carousel .swiper-ads-wrapper{width:100%;height:100%;display:flex;flex-wrap:nowrap;white-space:nowrap;cursor:grab;overflow:hidden;border-radius:12px}.liveshop-ads-carousel .swiper-ads-slide{border-radius:12px;overflow:hidden;height:100%}.liveshop-ads-carousel .swiper-ads-slide:first-child{margin-left:auto}.liveshop-ads-carousel .swiper-ads-slide:last-child{margin-right:auto}.liveshop-ads-carousel .swiper-ads-controls>.swiper-ads-controls-btn{position:absolute;transform:translateY(-50%);z-index:2;opacity:1;transition:opacity .3s;top:50%;content:"";width:42px;height:42px;border-radius:50%;cursor:pointer;z-index:2;display:flex;justify-content:center;align-items:center;background:rgba(0,0,0,.4);backdrop-filter:blur(2px);-webkit-backdrop-filter:blur(2px);border:1px solid rgba(0,0,0,.2)}.liveshop-ads-carousel .swiper-ads-controls>.swiper-ads-controls-btn::before{content:"";display:block;width:10px;height:10px;border:2px solid #fff;border-width:2px 2px 0 0;transform:rotate(45deg);position:relative;left:-2px}.liveshop-ads-carousel .swiper-ads-controls>.swiper-ads-controls-btn.-right{display:none;right:0}.liveshop-ads-carousel .swiper-ads-controls>.swiper-ads-controls-btn.-left{display:none;left:0}.liveshop-ads-carousel .swiper-ads-controls>.swiper-ads-controls-btn.-left::before{transform:rotate(225deg);left:3px;top:1px} </style>\n\n <div class="liveshop-ads-carousel" style="height: ${this.height}; width: 100%;max-width: ${this.width};" >\n <div class="swiper-ads-wrapper" style="gap: ${this.gap};" id="${this.liveshopAdsCarouselId}">\n ${e.map((e,s)=>{var i;return`\n <div class="swiper-ads-slide ${this.getHideContentClass()}" style="min-width: ${this.storiesSize||this.videosWidth}; width: ${this.storiesSize||this.videosWidth}; max-width: ${this.storiesSize||this.videosWidth};">\n <liveshop-ads-video \n aspect-ratio="${this.aspectRatio}"\n border-radius="${this.borderRadius}" \n ads-in-swiper="true" \n theme="${this.theme}" \n ads-video-object="${this.convertJsonToString(e)}" \n slug-video="${e.slugVideo||e.slug||"LIVESHOP_VIDEO_ERROR"}" \n stories-style="${this.storiesStyle}"\n stories-size="${this.storiesSize}"\n is-video-commerce="${this.isVideoCommerce}"\n stories-color="${this.storiesColor}"\n emit-impression-event="${this.emitImpressionEvent}"\n overlay-position="${this.overlayPosition}"\n ${(null===(i=this.reelsSlugsVideoPlaylist)||void 0===i?void 0:i[s])?`slugs-reels="${this.reelsSlugsVideoPlaylistFormat(this.reelsSlugsVideoPlaylist[s])}"`:""}\n ${this.user?`user="${this.convertJsonToString(this.user)}"`:""} \n ${this.hml?'hml="true"':""} \n ${this.marketplaceReels?'marketplace-reels="true"':""}\n ${this.usePostMessage?'use-post-message="true"':""} \n ${this.embedded?'embedded="true"':""} \n ${this.skipTerms?'skip-terms="true"':""} \n ${this.useLegacyOverlay?'use-legacy-overlay="true"':""}\n ${this.getHideContentClass()?'hide-content="true"':""} \n ${this.showLogo?'show-logo="true"':""}\n ${this.useActiveVideosFrom?'use-active-videos-from="true"':""}\n ></liveshop-ads-video>\n </div>\n `}).join("")}\n </div>\n\n <div class="swiper-ads-controls">\n <div class="swiper-ads-controls-btn -left" id="${this.swiperPreviousBtnId}"></div>\n <div class="swiper-ads-controls-btn -right" id="${this.swiperNextBtnId}"></div>\n </div>\n </div>\n `:"",this.addSwiperEvents()})}createDefaultReels(){try{const e=this.slugsVideo.replace(/\s/g,"").split(",");this.reelsSlugsVideo=e.map(s=>`[${s},${e.filter(e=>e!==s)}]`).join(";")}catch(e){console.error("Erro ao montar a playlist de reels DEFAULT:",e)}}doImpressionEventToAllAds(e){fetch(`${this.API_DADOS}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.map(e=>({attributeValue:"StreamAdsImpressionEvent",lojaId:e.storeId,lojaMatrizId:e.mainStoreId,usuarioId:this.userId,videoId:e.videoId,data:new Date})))})}reelsSlugsVideoPlaylistFormat(e){return JSON.stringify(e).replace(/"/g,"'")}createReelsInCarousel(){try{let e=this.reelsSlugsVideo.split(";");this.reelsSlugsVideoPlaylist=e.map(e=>{let s=e.trim();return"[]"===s?[]:s.slice(1,-1).split(",").filter(e=>!!e)})}catch(e){console.error("Erro ao criar a playlist de reels:",e)}}convertJsonToString(e){return JSON.stringify(e).replace(/"/g,"LIVESHOP_ADS_QUOTES_REPLACE")}fetchAllCarouselAds(){return __awaiter(this,void 0,void 0,function*(){try{const e=new URLSearchParams;this.videosFromStore?(e.append("origin",this.origin||(window.top||window).location.href),e.append("storeSlug",this.videosFromStore),e.append("tagName",this.name)):this.slugsVideo?e.append("slugs",this.slugsVideo):this.useActiveVideosFrom&&(e.append("storeSlug",this.useActiveVideosFrom),e.append("onlyActives","true"),this.useTags&&e.append("filterByTags",this.useTags)),e.append("quality",this.quality);const s=yield fetch(`${this.API_PUBLIC}/video/ads?${e.toString()}`);return yield s.json()}catch(e){return console.error("Erro ao buscar video:",e),[]}})}addSwiperEvents(){var _a,_b,_c;const scrollContainer=null===(_a=this.shadowRoot)||void 0===_a?void 0:_a.getElementById(this.liveshopAdsCarouselId),scrollLeftBtn=null===(_b=this.shadowRoot)||void 0===_b?void 0:_b.getElementById(this.swiperPreviousBtnId),scrollRightBtn=null===(_c=this.shadowRoot)||void 0===_c?void 0:_c.getElementById(this.swiperNextBtnId),liveshopAdsSwiper=eval("LiveshopAdsSwiper");liveshopAdsSwiper(scrollContainer,scrollLeftBtn,scrollRightBtn,this.videosWidth)}getUser(){return __awaiter(this,void 0,void 0,function*(){var e,s,i,t,o,r;try{const n=localStorage.getItem(this.localStorageUserIdKey);if(n&&"undefined"!==n){const a=yield this.fetchUserById(n);try{this.userId=null!==(t=null!==(s=null===(e=this.convertStringToJson(a))||void 0===e?void 0:e.usuarioId)&&void 0!==s?s:null===(i=null==a?void 0:a.findUser)||void 0===i?void 0:i.id)&&void 0!==t?t:null}catch(e){this.userId=null!==(r=null===(o=null==a?void 0:a.findUser)||void 0===o?void 0:o.id)&&void 0!==r?r:null}return this.user=null!=a?a:null,this.user}{if(!(yield this.createUser()))return null;const e=this.userId||localStorage.getItem(this.localStorageUserIdKey);if(!e)return null;const s=yield this.fetchUserById(e);return this.user=null!=s?s:null,this.user}}catch(e){return console.error("[ LIVESHOP ADS VIDEO ] Não foi possível obter o usuário",e),this.user=null,null}})}fetchUserById(e){return __awaiter(this,void 0,void 0,function*(){var s,i;const t={method:"POST",body:JSON.stringify({query:"\n query findUserQuery($id: String!) {\n findUser(id: $id) {\n id\n nome\n role\n metaDados {\n localizacao {\n codigoPais\n nomePais\n codigoEstado\n nomeEstado\n nomeCidade\n cep\n }\n dispositivo {\n navegador { name version versionMajor }\n especificacao { brand isMobileDevice type }\n sistemaOperacional { name }\n tipo\n }\n }\n banido\n email\n }\n }",variables:{id:e}})},o=yield fetch(this.API_PUBLIC+"/graphql",t),r=yield o.json();return null!==(i=null!==(s=null==r?void 0:r.data)&&void 0!==s?s:r)&&void 0!==i?i:null})}getUserLocation(){return __awaiter(this,void 0,void 0,function*(){try{const e=yield fetch("https://aws-headers.streamshop.com.br"),s=yield e.json();this.anonymousUser.localizacao=(null==s?void 0:s.cloudFrontViewerCity)?{cep:s.cloudFrontViewerPostalCode,codigoEstado:s.cloudFrontViewerCountryRegion,codigoPais:s.cloudFrontViewerCountry,nomeCidade:s.cloudFrontViewerCity,nomeEstado:s.cloudFrontViewerCountryRegionName}:null}catch(e){console.error("[ LIVESHOP ADS VIDEO ] Não foi possível obter a localização do usuário")}})}createUser(){return __awaiter(this,void 0,void 0,function*(){var e,s,i,t,o,r,n,a;try{yield this.getUserLocation();const l={method:"POST",body:JSON.stringify({query:"\n mutation createUserMutation($id: String, $nome: String!, $role: Int!, $metaDados: MetaDadosUsuarioInput) {\n createUser(id: $id, nome: $nome, role: $role, metaDados: $metaDados) {\n id\n nome\n role\n metaDados {\n localizacao {\n codigoPais\n nomePais\n codigoEstado\n nomeEstado\n nomeCidade\n cep\n }\n dispositivo {\n navegador { name version versionMajor }\n especificacao { brand isMobileDevice type }\n sistemaOperacional { name }\n tipo\n }\n }\n banido\n email\n }\n }",variables:this.anonymousUser})},d=yield fetch(this.API_PUBLIC+"/graphql",l),h=yield d.text(),u=JSON.parse(h),c=null!==(o=null!==(i=null===(s=null===(e=null==u?void 0:u.data)||void 0===e?void 0:e.createUser)||void 0===s?void 0:s.id)&&void 0!==i?i:null===(t=null==u?void 0:u.createUser)||void 0===t?void 0:t.id)&&void 0!==o?o:null;return!!c&&(localStorage.setItem(this.localStorageUserIdKey,c),this.userId=c,this.user=null!==(a=null!==(n=null===(r=null==u?void 0:u.data)||void 0===r?void 0:r.createUser)&&void 0!==n?n:null==u?void 0:u.createUser)&&void 0!==a?a:null,!0)}catch(e){return console.error("[ LIVESHOP ADS VIDEO ] Erro ao criar usuário",e),!1}})}}customElements.define("liveshop-ads-carousel",LiveshopAdsCarousel);