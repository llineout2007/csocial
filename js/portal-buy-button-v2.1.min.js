(function(){var t,e,i=function(t,e){return function(){return t.apply(e,arguments)}},s=[].slice;(e=window||exports).EVENT_HISTORY||(e.EVENT_HISTORY={}),t=function(){function t(){this.generateSelectors=i(this.generateSelectors,this),this.triggerProductEvent=i(this.triggerProductEvent,this),this.bindProductEvent=i(this.bindProductEvent,this)}return t.prototype.bindProductEvent=function(t,e,i){var n,r,u,o,h,a;if(null==i&&(i=0),n=function(t,e,n){var r;if($(window).on(t,function(){var t,r,u;if(r=arguments[0],t=2<=arguments.length?s.call(arguments,1):[],n===(u=t[i]))return e.apply(null,[r].concat(s.call(t)))}),(null!=(r=EVENT_HISTORY[n])?r[t]:void 0)!=null)return e.apply(null,EVENT_HISTORY[n][t])},!this.options.multipleProductIds)return n(t,e,this.productId);for(u=0,h=this.productId,a=[],o=h.length;u<o;u++)r=h[u],a.push(n(t,e,r));return a},t.prototype.triggerProductEvent=function(){var t,e,i,n,r,u;return r=arguments[0],t=2<=arguments.length?s.call(arguments,1):[],i=this.element||$window,n=jQuery.Event(r),e=[this.productId].concat(s.call(t)),i.trigger(n,e),EVENT_HISTORY[u=this.productId]||(EVENT_HISTORY[u]={}),EVENT_HISTORY[this.productId][r]=[n].concat(s.call(e))},t.prototype.generateSelectors=function(t){var e,i,s,n,r=this;for(s in t)"function"==typeof(n=t[s])?this["find"+s]=n:this["find"+s]=function(t){return function(){return r.element.find(t)}}(n),this["findFirst"+s]=function(t){return function(){return $(r["find"+t]()[0])}}(s),this["show"+s]=function(t){return function(){return r["find"+t]().show()}}(s),this["hide"+s]=function(t){return function(){return r["find"+t]().hide()}}(s);return this.showAll=(e=t,function(){var t;for(s in t=[],e)n=e[s],t.push(r["show"+s]());return t}),this.hideAll=(i=t,function(){var t;for(s in t=[],i)n=i[s],t.push(r["hide"+s]());return t})},t}(),e.ProductComponent=t}).call(this),(function(){var t,e,i=function(t,e){return function(){return t.apply(e,arguments)}},s={}.hasOwnProperty,n=function(t,e){for(var i in e)s.call(e,i)&&(t[i]=e[i]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};t=window.jQuery,e=function(e){function s(t,e,s,n){var r,u,o,h,a=this;if(this.element=t,this.productId=e,null==s&&(s={}),this.options=n,this.buyButtonHandler=i(this.buyButtonHandler,this),this.update=i(this.update,this),this.valid=i(this.valid,this),this.getErrorURL=i(this.getErrorURL,this),this.getURL=i(this.getURL,this),this.accessoriesUpdated=i(this.accessoriesUpdated,this),this.quantityChanged=i(this.quantityChanged,this),this.skuUnselected=i(this.skuUnselected,this),this.skuSelected=i(this.skuSelected,this),this.getChangesFromHREF=i(this.getChangesFromHREF,this),this.bindEvents=i(this.bindEvents,this),this.sku=s.sku||null,this.quantity=s.quantity||1,this.seller=s.seller||1,this.salesChannel=s.salesChannel||1,this.priceToken=s.priceToken||null,this.options.multipleProductIds)for(u=0,this.manyProducts={},o=(h=this.productId).length;u<o;u++)r=h[u],this.manyProducts[r]={sku:null,quantity:1,seller:1};this.accessories=[],"undefined"!=typeof CATALOG_SDK&&null!==CATALOG_SDK&&(this.SDK=CATALOG_SDK,this.SDK.getProductWithVariations(this.productId).done(function(t){return a.productData=t,1===a.productData.skus.length&&(a.triggerProductEvent("vtex.sku.selected",a.productData.skus[0]),a.triggerProductEvent("skuSelected.vtex",a.productData.skus[0])),a.getChangesFromHREF(),a.update()})),this.getChangesFromHREF(),this.bindEvents(),this.update()}return n(s,e),s.prototype.bindEvents=function(){return this.bindProductEvent("skuSelected.vtex",this.skuSelected),this.bindProductEvent("skuUnselected.vtex",this.skuUnselected),this.bindProductEvent("quantityReady.vtex",this.quantityChanged),this.bindProductEvent("quantityChanged.vtex",this.quantityChanged),this.bindProductEvent("accessoriesUpdated.vtex",this.accessoriesUpdated),this.element.on("click",this.buyButtonHandler)},s.prototype.getChangesFromHREF=function(){var t,e,i,s,n,r;return t=this.element.attr("href"),this._url!==t&&((n=t.match(/sku=(.*?)&/))&&n[1]&&n[1]!==this.sku&&(this.sku=n[1],this.triggerProductEvent("vtex.sku.changed",{sku:this.sku}),this.triggerProductEvent("skuChanged.vtex",{sku:this.sku}),(r=t.match(/priceToken=(.*?)&/))&&r[1]&&(this.priceToken=r[1])),(e=t.match(/qty=(.*?)&/))&&e[1]&&e[1]!==this.quantity&&(this.quantity=e[1],this.triggerProductEvent("vtex.quantity.changed",this.quantity),this.triggerProductEvent("quantityChanged.vtex",this.quantity)),(s=t.match(/seller=(.*?)&/))&&s[1]&&s[1]!==this.seller&&(this.seller=s[1],(r=t.match(/priceToken=(.*?)&/))&&r[1]&&(this.priceToken=r[1])),(i=t.match(/sc=(.*?)&/))&&i[1]&&i[1]!==this.salesChannel&&(this.salesChannel=i[1])),this._url=t},s.prototype.skuSelected=function(t,e,i){if(this.getChangesFromHREF(),this.options.multipleProductIds?this.manyProducts[e].sku=i:(this.skuData=i,this.sku=i.sku,this.seller=i.sellerId,i.priceToken&&(this.priceToken=i.priceToken)),this.update(),this.options.instaBuy&&i.available)return this.element.click()},s.prototype.skuUnselected=function(t,e,i){return this.getChangesFromHREF(),this.options.multipleProductIds?this.manyProducts[e].sku=null:(this.skuData={},this.sku=null,this.priceToken=null),this.update()},s.prototype.quantityChanged=function(t,e,i){return this.getChangesFromHREF(),this.options.multipleProductIds?this.manyProducts[e].quantity=i:this.quantity=i,this.update()},s.prototype.accessoriesUpdated=function(t,e,i){return this.getChangesFromHREF(),this.accessories=i,this.update()},s.prototype.getURL=function(){var t,e,i,s,n,r,u,o,h,a,d,c;if(!this.valid())return this.getErrorURL();if(n=[],this.options.multipleProductIds)for(e in a=this.manyProducts)(s=a[e]).sku&&s.sku.available&&(n.push("sku="+s.sku.sku),n.push("qty="+s.quantity),n.push("seller="+s.seller),s.sku.priceToken&&n.push("priceToken="+s.priceToken));else n.push("sku="+this.sku),n.push("qty="+this.quantity),n.push("seller="+this.seller),this.priceToken&&n.push("priceToken="+this.priceToken);for(n.push("redirect="+this.options.redirect),n.push("sc="+this.salesChannel),d=this.accessories,o=0,h=d.length;o<h;o++)(t=d[o]).quantity>0&&(n.push("sku="+t.sku),n.push("qty="+t.quantity),n.push("seller="+t.sellerId),t.priceToken&&n.push("priceToken="+t.priceToken));for(i in this.options.giftRegistry&&n.push("gr="+this.options.giftRegistry),this.options.target&&n.push("target="+this.options.target),c=this.options.queryParams)u=c[i],n.push(""+i+"="+u);return"/checkout/cart/add?"+n.join("&")},s.prototype.getErrorURL=function(){return this.options.alertOnError?"javascript:alert('"+this.options.errorMessage+"');":"javascript:void(0);"},s.prototype.valid=function(){return!!(this.sku||this.options.multipleProductIds)},s.prototype.update=function(){if(this.element.attr("href",this.getURL()),this.element.show(),this.options.hideUnavailable&&this.skuData&&!1===this.skuData.available&&this.element.hide(),this.options.hideUnselected&&!this.skuData&&this.element.hide(),this.productData&&!1===this.productData.available)return this.element.hide()},s.prototype.buyButtonHandler=function(e){var i=this;return this.valid()?(this.triggerProductEvent("vtex.buyButton.through",this.getURL),this.triggerProductEvent("buyButtonThrough.vtex",this.getURL),!!this.options.redirect||(t(window).trigger("vtex.modal.hide"),t(window).trigger("modalHide.vtex"),t.get(this.getURL()).done(function(){if(i.triggerProductEvent("productAddedToCart"),i.triggerProductEvent("vtex.cart.productAdded"),i.triggerProductEvent("cartProductAdded.vtex"),i.options.addMessage)return alert(i.options.addMessage)}).fail(function(){if(i.redirect=!0,window.location.href=i.getURL(),i.options.errMessage)return alert(i.options.errMessage)}),e.preventDefault(),!1)):(this.triggerProductEvent("vtex.buyButton.failedAttempt",this.options.errorMessage),this.triggerProductEvent("buyButtonFailedAttempt.vtex",this.options.errorMessage),!0)},s}(ProductComponent),t.fn.buyButton=function(i,s,n){var r,u,o,h,a,d,c;for(d=0,u=t.extend(!0,{},t.fn.buyButton.defaults),c=this.length;d<c;d++)o=(r=t(h=this[d])).data(),a=t.extend(!0,u,o,n),r.data("buyButton")||r.data("buyButton",new e(r,i,s,a));return this},t.fn.buyButton.defaults={errorMessage:"Por favor, selecione o modelo desejado.",alertOnError:!0,redirect:!0,addMessage:null,errMessage:null,instaBuy:!1,hideUnselected:!1,hideUnavailable:!0,target:null,multipleProductIds:!1,queryParams:{}}}).call(this);